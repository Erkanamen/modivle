/**
 * almond 0.1.1 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/* Zepto v1.0rc1 - polyfill zepto event detect fx ajax form touch - zeptojs.com/license */

//     Underscore.js 1.3.1
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 * KeyboardJS
 * 
 * Copyright 2011, Robert William Hurst
 * Licenced under the BSD License.
 * See https://raw.github.com/RobertWHurst/KeyboardJS/master/license.txt
 */

(function(){var requirejs,require,define;(function(e){function a(e,t){var n=t&&t.split("/"),i=r.map,s=i&&i["*"]||{},o,u,a,f,l,c,h;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(l=0;h=e[l];l++)if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))return!0;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((n||s)&&i){o=e.split("/");for(l=o.length;l>0;l-=1){u=o.slice(0,l).join("/");if(n)for(c=n.length;c>0;c-=1){a=i[n.slice(0,c).join("/")];if(a){a=a[u];if(a){f=a;break}}}f=f||s[u];if(f){o.splice(0,l,f),e=o.join("/");break}}}return e}function f(t,n){return function(){return u.apply(e,s.call(arguments,0).concat([t,n]))}}function l(e){return function(t){return a(t,e)}}function c(e){return function(n){t[e]=n}}function h(r){if(n.hasOwnProperty(r)){var s=n[r];delete n[r],i[r]=!0,o.apply(e,s)}if(!t.hasOwnProperty(r))throw new Error("No "+r);return t[r]}function p(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=a(e.slice(0,i),t),e=e.slice(i+1),r=h(n),r&&r.normalize?e=r.normalize(e,l(t)):e=a(e,t)):e=a(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function d(e){return function(){return r&&r.config&&r.config[e]||{}}}var t={},n={},r={},i={},s=[].slice,o,u;o=function(r,s,o,u){var a=[],l,v,m,g,y,b;u=u||r;if(typeof o=="function"){s=!s.length&&o.length?["require","exports","module"]:s;for(b=0;b<s.length;b++){y=p(s[b],u),m=y.f;if(m==="require")a[b]=f(r);else if(m==="exports")a[b]=t[r]={},l=!0;else if(m==="module")v=a[b]={id:r,uri:"",exports:t[r],config:d(r)};else if(t.hasOwnProperty(m)||n.hasOwnProperty(m))a[b]=h(m);else if(y.p)y.p.load(y.n,f(u,!0),c(m),{}),a[b]=t[m];else if(!i[m])throw new Error(r+" missing "+m)}g=o.apply(t[r],a);if(r)if(v&&v.exports!==e&&v.exports!==t[r])t[r]=v.exports;else if(g!==e||!l)t[r]=g}else r&&(t[r]=o)},requirejs=require=u=function(t,n,i,s){return typeof t=="string"?h(p(t,n).f):(t.splice||(r=t,n.splice?(t=n,n=i,i=null):t=e),n=n||function(){},s?o(e,t,n,i):setTimeout(function(){o(e,t,n,i)},15),u)},u.config=function(e){return r=e,u},define=function(e,t,r){t.splice||(r=t,t=[]),n[e]=[e,t,r]},define.amd={jQuery:!0}})(),define("libs/almond",function(){}),function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r)i in n&&(s=t.call(e,s,n[i],i,n)),i++;return s})}();var Zepto=function(){function C(e){return E.call(e)=="[object Function]"}function k(e){return e instanceof Object}function L(t){var n,r;if(E.call(t)!=="[object Object]")return!1;r=C(t.constructor)&&t.constructor.prototype;if(!r||!hasOwnProperty.call(r,"isPrototypeOf"))return!1;for(n in t);return n===e||hasOwnProperty.call(t,n)}function A(e){return e instanceof Array}function O(e){return typeof e.length=="number"}function M(t){return t.filter(function(t){return t!==e&&t!==null})}function _(e){return e.length>0?[].concat.apply([],e):e}function D(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(e){return e in a?a[e]:a[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function H(e,t){return typeof t=="number"&&!l[D(e)]?t+"px":t}function B(e){var t,n;return u[e]||(t=o.createElement(e),o.body.appendChild(t),n=f(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),u[e]=n),u[e]}function j(t,r){return r===e?n(t):n(t).filter(r)}function F(e,t,n,r){return C(t)?t.call(e,n,r):t}function I(e,t,r){var i=e%2?t:t.parentNode;i?i.insertBefore(r,e?e==1?i.firstChild:e==2?t:null:t.nextSibling):n(r).remove()}function q(e,t){t(e);for(var n in e.childNodes)q(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=window.document,u={},a={},f=o.defaultView.getComputedStyle,l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=[1,3,8,9,11],p=["after","prepend","before","append"],d=o.createElement("table"),v=o.createElement("tr"),m={tr:o.createElement("tbody"),tbody:d,thead:d,tfoot:d,td:v,th:v,"*":o.createElement("div")},g=/complete|loaded|interactive/,y=/^\.([\w-]+)$/,b=/^#([\w-]+)$/,w=/^[\w-]+$/,E={}.toString,S={},x,T,N=o.createElement("div");return S.matches=function(e,t){if(!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=N).appendChild(e),r=~S.qsa(i,t).indexOf(e),s&&N.removeChild(e),r},x=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},T=function(e){return e.filter(function(t,n){return e.indexOf(t)==n})},S.fragment=function(t,r){r===e&&(r=c.test(t)&&RegExp.$1),r in m||(r="*");var i=m[r];return i.innerHTML=""+t,n.each(s.call(i.childNodes),function(){i.removeChild(this)})},S.Z=function(e,t){return e=e||[],e.__proto__=arguments.callee.prototype,e.selector=t||"",e},S.isZ=function(e){return e instanceof S.Z},S.init=function(t,r){if(!t)return S.Z();if(C(t))return n(o).ready(t);if(S.isZ(t))return t;var i;if(A(t))i=M(t);else if(L(t))i=[n.extend({},t)],t=null;else if(h.indexOf(t.nodeType)>=0||t===window)i=[t],t=null;else if(c.test(t))i=S.fragment(t.trim(),RegExp.$1),t=null;else{if(r!==e)return n(r).find(t);i=S.qsa(o,t)}return S.Z(i,t)},n=function(e,t){return S.init(e,t)},n.extend=function(n){return s.call(arguments,1).forEach(function(r){for(t in r)r[t]!==e&&(n[t]=r[t])}),n},S.qsa=function(e,t){var n;return e===o&&b.test(t)?(n=e.getElementById(RegExp.$1))?[n]:i:e.nodeType!==1&&e.nodeType!==9?i:s.call(y.test(t)?e.getElementsByClassName(RegExp.$1):w.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},n.isFunction=C,n.isObject=k,n.isArray=A,n.isPlainObject=L,n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.trim=function(e){return e.trim()},n.uuid=0,n.map=function(e,t){var n,r=[],i,s;if(O(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return _(r)},n.each=function(e,t){var n,r;if(O(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,indexOf:i.indexOf,concat:i.concat,map:function(e){return n.map(this,function(t,n){return e.call(t,n,t)})},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return g.test(o.readyState)?e(n):o.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return this.forEach(function(t,n){e.call(t,n,t)}),this},filter:function(e){return n([].filter.call(this,function(t){return S.matches(t,e)}))},add:function(e,t){return n(T(this.concat(n(e,t))))},is:function(e){return this.length>0&&S.matches(this[0],e)},not:function(t){var r=[];if(C(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):O(t)&&C(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!k(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!k(e)?e:n(e)},find:function(e){var t;return this.length==1?t=S.qsa(this[0],e):t=this.map(function(){return S.qsa(this,e)}),n(t)},closest:function(e,t){var r=this[0];while(r&&!S.matches(r,e))r=r!==t&&r!==o&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&e!==o&&t.indexOf(e)<0)return t.push(e),e});return j(t,e)},parent:function(e){return j(T(this.pluck("parentNode")),e)},children:function(e){return j(this.map(function(){return s.call(this.children)}),e)},siblings:function(e){return j(this.map(function(e,t){return s.call(t.parentNode.children).filter(function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return this.map(function(){return this[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),f(this,"").getPropertyValue("display")=="none"&&(this.style.display=B(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){return this.each(function(){n(this).wrapAll(n(e)[0].cloneNode(!1))})},wrapAll:function(e){return this[0]&&(n(this[0]).before(e=n(e)),e.append(this)),this},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return n(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(t){return(t===e?this.css("display")=="none":t)?this.show():this.hide()},prev:function(){return n(this.pluck("previousElementSibling"))},next:function(){return n(this.pluck("nextElementSibling"))},html:function(t){return t===e?this.length>0?this[0].innerHTML:null:this.each(function(e){var r=this.innerHTML;n(this).empty().append(F(this,t,e,r))})},text:function(t){return t===e?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(k(n))for(t in n)this.setAttribute(t,n[t]);else this.setAttribute(n,F(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&this.removeAttribute(e)})},prop:function(t,n){return n===e?this[0]?this[0][t]:e:this.each(function(e){this[t]=F(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+D(t),n);return r!==null?r:e},val:function(t){return t===e?this.length>0?this[0].value:e:this.each(function(e){this.value=F(this,t,e,this.value)})},offset:function(){if(this.length==0)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}},css:function(n,r){if(r===e&&typeof n=="string")return this.length==0?e:this[0].style[x(n)]||f(this[0],"").getPropertyValue(n);var i="";for(t in n)typeof n[t]=="string"&&n[t]==""?this.each(function(){this.style.removeProperty(D(t))}):i+=D(t)+":"+H(t,n[t])+";";return typeof n=="string"&&(r==""?this.each(function(){this.style.removeProperty(D(n))}):i=D(n)+":"+H(n,r)),this.each(function(){this.style.cssText+=";"+i})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return this.length<1?!1:P(e).test(this[0].className)},addClass:function(e){return this.each(function(t){r=[];var i=this.className,s=F(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&(this.className+=(i?" ":"")+r.join(" "))})},removeClass:function(t){return this.each(function(n){if(t===e)return this.className="";r=this.className,F(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(P(e)," ")}),this.className=r.trim()})},toggleClass:function(t,r){return this.each(function(i){var s=F(this,t,i,this.className);(r===e?!n(this).hasClass(s):r)?n(this).addClass(s):n(this).removeClass(s)})}},["width","height"].forEach(function(t){n.fn[t]=function(r){var i,s=t.replace(/./,function(e){return e[0].toUpperCase()});return r===e?this[0]==window?window["inner"+s]:this[0]==o?o.documentElement["offset"+s]:(i=this.offset())&&i[t]:this.each(function(e){var i=n(this);i.css(t,F(this,r,e,i[t]()))})}}),p.forEach(function(e,t){n.fn[e]=function(){var e=n.map(arguments,function(e){return k(e)?e:S.fragment(e)});if(e.length<1)return this;var r=this.length,i=r>1,s=t<2;return this.each(function(n,o){for(var u=0;u<e.length;u++){var a=e[s?e.length-u-1:u];q(a,function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&window.eval.call(window,e.innerHTML)}),i&&n<r-1&&(a=a.cloneNode(!0)),I(t,o,a)}})},n.fn[t%2?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),S.Z.prototype=n.fn,S.camelize=x,S.uniq=T,n.zepto=S,n}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(e){function s(e){return e._zid||(e._zid=r++)}function o(e,t,r,i){t=u(t);if(t.ns)var o=a(t.ns);return(n[s(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||o.test(e.ns))&&(!r||s(e.fn)===s(r))&&(!i||e.sel==i)})}function u(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function a(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function f(t,n,r){e.isObject(t)?e.each(t,r):t.split(/\s/).forEach(function(e){r(e,n)})}function l(t,r,i,o,a,l){l=!!l;var c=s(t),h=n[c]||(n[c]=[]);f(r,i,function(n,r){var i=a&&a(r,n),s=i||r,f=function(e){var n=s.apply(t,[e].concat(e.data));return n===!1&&e.preventDefault(),n},c=e.extend(u(n),{fn:r,proxy:f,sel:o,del:i,i:h.length});h.push(c),t.addEventListener(c.e,f,l)})}function c(e,t,r,i){var u=s(e);f(t||"",r,function(t,r){o(e,t,r,i).forEach(function(t){delete n[u][t.i],e.removeEventListener(t.e,t.proxy,!1)})})}function v(t){var n=e.extend({originalEvent:t},t);return e.each(d,function(e,r){n[e]=function(){return this[r]=h,t[e].apply(t,arguments)},n[r]=p}),n}function m(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var t=e.zepto.qsa,n={},r=1,i={};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents",e.event={add:l,remove:c},e.proxy=function(t,n){if(e.isFunction(t)){var r=function(){return t.apply(n,arguments)};return r._zid=s(t),r}if(typeof n=="string")return e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){c(this,e,t)})},e.fn.one=function(e,t){return this.each(function(n,r){l(this,e,t,null,function(e,t){return function(){var n=e.apply(r,arguments);return c(r,t,e),n}})})};var h=function(){return!0},p=function(){return!1},d={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,r){var i=!1;if(n=="blur"||n=="focus")e.iswebkit?n=n=="blur"?"focusout":n=="focus"?"focusin":n:i=!0;return this.each(function(s,o){l(o,n,r,t,function(n){return function(r){var i,s=e(r.target).closest(t,o).get(0);if(s)return i=e.extend(v(r),{currentTarget:s,liveFired:o}),n.apply(s,[i].concat([].slice.call(arguments,1)))}},i)})},e.fn.undelegate=function(e,t,n){return this.each(function(){c(this,t,n,e)})},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r){return n==undefined||e.isFunction(n)?this.bind(t,n):this.delegate(n,t,r)},e.fn.off=function(t,n,r){return n==undefined||e.isFunction(n)?this.unbind(t,n):this.undelegate(n,t,r)},e.fn.trigger=function(t,n){return typeof t=="string"&&(t=e.Event(t)),m(t),t.data=n,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(s,u){r=v(typeof t=="string"?e.Event(t):t),r.data=n,r.target=u,e.each(o(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){if(e)this.bind(t,e);else if(this.length)try{this.get(0)[t]()}catch(n){}return this}}),e.Event=function(e,t){var n=document.createEvent(i[e]||"Events"),r=!0;if(t)for(var s in t)s=="bubbles"?r=!!t[s]:n[s]=t[s];return n.initEvent(e,r,!0,null,null,null,null,null,null,null,null,null,null,null,null),n}}(Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/WebKit\/([\d.]+)/),i=e.match(/(Android)\s+([\d.]+)/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),a=u&&e.match(/TouchPad/),f=e.match(/Kindle\/([\d.]+)/),l=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]),o&&(t.ios=t.iphone=!0,t.version=o[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),u&&(t.webos=!0,t.version=u[2]),a&&(t.touchpad=!0),c&&(t.blackberry=!0,t.version=c[2]),f&&(t.kindle=!0,t.version=f[1]),l&&(n.silk=!0,n.version=l[1]),!l&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0)}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e,t){function c(e){return e.toLowerCase()}function h(e){return r?r+e:c(e)}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t)return n="-"+c(e)+"-",r=i,!1}),l[n+"transition-property"]=l[n+"transition-duration"]=l[n+"transition-timing-function"]=l[n+"animation-name"]=l[n+"animation-duration"]="",e.fx={off:r===t&&a.style.transitionProperty===t,cssPrefix:n,transitionEnd:h("TransitionEnd"),animationEnd:h("AnimationEnd")},e.fn.animate=function(t,n,r,i){return e.isObject(n)&&(r=n.easing,i=n.complete,n=n.duration),n&&(n/=1e3),this.anim(t,n,r,i)},e.fn.anim=function(r,i,s,o){var u,a={},c,h=this,p,d=e.fx.transitionEnd;i===t&&(i=.4),e.fx.off&&(i=0);if(typeof r=="string")a[n+"animation-name"]=r,a[n+"animation-duration"]=i+"s",d=e.fx.animationEnd;else{for(c in r)f.test(c)?(u||(u=[]),u.push(c+"("+r[c]+")")):a[c]=r[c];u&&(a[n+"transform"]=u.join(" ")),!e.fx.off&&typeof r=="object"&&(a[n+"transition-property"]=Object.keys(r).join(", "),a[n+"transition-duration"]=i+"s",a[n+"transition-timing-function"]=s||"linear")}return p=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(d,arguments.callee)}e(this).css(l),o&&o.call(this)},i>0&&this.bind(d,p),setTimeout(function(){h.css(a),i<=0&&setTimeout(function(){h.each(function(){p.call(this)})},0)},0),this},a=null}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.defaultPrevented}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n){var r=n.context,i="success";n.success.call(r,e,i,t),triggerGlobal(n,r,"ajaxSuccess",[t,n,e]),ajaxComplete(i,t,n)}function ajaxError(e,t,n,r){var i=r.context;r.error.call(i,n,t,e),triggerGlobal(r,i,"ajaxError",[n,r,e]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){isObject(e.data)&&(e.data=$.param(e.data)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data))}function serialize(e,t,n,r){var i=$.isArray(t);$.each(t,function(t,s){r&&(t=n?r:r+"["+(i?"":t)+"]"),!r&&i?e.add(s.name,s.value):(n?$.isArray(s):isObject(s))?serialize(e,s,n,t):e.add(t,s)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e){var t="jsonp"+ ++jsonpID,n=document.createElement("script"),r=function(){$(n).remove(),t in window&&(window[t]=empty),ajaxComplete("abort",i,e)},i={abort:r},s;return e.error&&(n.onerror=function(){i.abort(),e.error()}),window[t]=function(r){clearTimeout(s),$(n).remove(),delete window[t],ajaxSuccess(r,i,e)},serializeData(e),n.src=e.url.replace(/=\?/,"="+t),$("head").append(n),e.timeout>0&&(s=setTimeout(function(){i.abort(),ajaxComplete("timeout",i,e)},e.timeout)),i},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);settings.url||(settings.url=window.location.toString()),serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(e,t){return $.ajax({url:e,success:t})},$.post=function(e,t,n,r){return $.isFunction(t)&&(r=r||n,n=t,t=null),$.ajax({type:"POST",url:e,data:t,success:n,dataType:r})},$.getJSON=function(e,t){return $.ajax({url:e,success:t,dataType:"json"})},$.fn.load=function(e,t){if(!this.length)return this;var n=this,r=e.split(/\s/),i;return r.length>1&&(e=r[0],i=r[1]),$.get(e,function(e){n.html(i?$(document.createElement("div")).html(e.replace(rscript,"")).find(i).html():e),t&&t.call(n)}),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace("%20","+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e(Array.prototype.slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(e){function r(e){return"tagName"in e?e:e.parentNode}function i(e,t,n,r){var i=Math.abs(e-t),s=Math.abs(n-r);return i>=s?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}function u(){o=null,t.last&&(t.el.trigger("longTap"),t={})}function a(){o&&clearTimeout(o),o=null}var t={},n,s=750,o;e(document).ready(function(){var f,l;e(document.body).bind("touchstart",function(i){f=Date.now(),l=f-(t.last||f),t.el=e(r(i.touches[0].target)),n&&clearTimeout(n),t.x1=i.touches[0].pageX,t.y1=i.touches[0].pageY,l>0&&l<=250&&(t.isDoubleTap=!0),t.last=f,o=setTimeout(u,s)}).bind("touchmove",function(e){a(),t.x2=e.touches[0].pageX,t.y2=e.touches[0].pageY}).bind("touchend",function(e){a(),t.isDoubleTap?(t.el.trigger("doubleTap"),t={}):t.x2&&Math.abs(t.x1-t.x2)>30||t.y2&&Math.abs(t.y1-t.y2)>30?(t.el.trigger("swipe")&&t.el.trigger("swipe"+i(t.x1,t.x2,t.y1,t.y2)),t={}):"last"in t&&(t.el.trigger("tap"),n=setTimeout(function(){n=null,t.el.trigger("singleTap"),t={}},250))}).bind("touchcancel",function(){n&&clearTimeout(n),o&&clearTimeout(o),o=n=null,t={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}(Zepto),define("libs/zepto",function(){}),define("jquery",["libs/zepto"],function(){return require(["libs/zepto"]),this.Zepto}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new O(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.1";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e))return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e))return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){r==0?t[0]=e:(n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e)}),t},S.sortBy=function(e,t,n){return S.pluck(S.map(e,function(e,r,i){return{value:e,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?e.toArray?e.toArray():S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):S.values(e):[]},S.size=function(e){return S.toArray(e).length},S.first=S.head=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return S.reduce(r,function(n,r,s){if(0==s||(t===!0?S.last(n)!=r:!S.include(n,r)))n[n.length]=r,i[i.length]=e[s];return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1));return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(e,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var a=function(){i=null,o&&e.apply(n,r),u()};i||(i=setTimeout(a,t)),s?o=!0:e.apply(n,r),u(),s=!0}},S.debounce=function(e,t){var n;return function(){var r=this,i=arguments,s=function(){n=null,e.apply(r,i)};clearTimeout(n),n=setTimeout(s,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.mixin=function(e){x(S.functions(e),function(t){_(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A=function(e){return e.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};S.template=function(e,t){var n=S.templateSettings,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape||L,function(e,t){return"',_.escape("+A(t)+"),'"}).replace(n.interpolate||L,function(e,t){return"',"+A(t)+",'"}).replace(n.evaluate||L,function(e,t){return"');"+A(t).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj","_",r);return t?i(t,S):function(e){return i.call(this,e,S)}},S.chain=function(e){return S(e).chain()};var O=function(e){this._wrapped=e};S.prototype=O.prototype;var M=function(e,t){return t?S(e).chain():e},_=function(e,t){O.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),M(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];O.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],M(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];O.prototype[e]=function(){return M(t.apply(this._wrapped,arguments),this._chain)}}),O.prototype.chain=function(){return this._chain=!0,this},O.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}.call(this),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),define("desktop_ich",["underscore"],function(e){var t={};t.loading="<div class='modal message'>	<div id='overlay_close'></div>	<span>Loading your modules, Please be patient...</span></div>",t.keyboardshortcuts="<div class='modal keyboardshortcuts'>	<div id='overlay_close'></div>	<div class='title'>Keyboard shortcuts</div>	<div class='contents'>		<div class='navigation col'>			<div class='coltitle'>Navigation</div>			<div class='row'>				<span class='keys'>					<span class='key'>J</span>				</span>				<span class='desc'>Next</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>K</span>				</span>				<span class='desc'>Previous</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>Enter</span>				</span>				<span class='desc'>Action / Select</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>?</span>				</span>				<span class='desc'>This menu</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>Esc</span>				</span>				<span class='desc'>Close this menu</span>			</div>		</div>		<div class='jumping col'>			<div class='coltitle'>Jumping</div>			<div class='row'>				<span class='keys'>					<span class='key'>G</span>					<span class='key'>M</span>				</span>				<span class='desc'>Modules</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>G</span>					<span class='key'>A</span>				</span>				<span class='desc'>Announcements</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>G</span>					<span class='key'>W</span>				</span>				<span class='desc'>Workbin</span>			</div>			<div class='row'>				<span class='keys'>					<span class='key'>G</span>					<span class='key'>F</span>				</span>				<span class='desc'>Forum</span>			</div>		</div>	</div></div>",t.moduleview="<div class='modulecode'>{{code}}</div>",t.contentview="<div id='tabs'></div><div id='tabcontent'></div>",t.breadcrumb="<div class='arrow'></div><span>{{name}}</span>",t.breadcrumbicon="<div class='icon {{type}}icon'></div>",t.forumview="<div class='tabheading' id='forumheader'></div><div class='tabcontents'>	<div id='forumcontents'></div></div>",t.forumheadingview="<div class='rowname'>	<div class='rowicon headingicon'></div>	<span>{{name}}</span></div><div class='rowcol2'></div><div class='rowcol3'></div>",t.forumthreadview="<div class='rowicon threadicon'></div><div class='posttitle'>	<div class='posttitlemain'>		<span class='main'>{{ name }}</span>		<span class='dot'>&middot;</span>		<span class='author'>{{ author }}</span>	</div>	<span class='date'>{{ nicedate }}</span></div>",t.forumforumview="<div class='rowname'>	<div class='rowicon headingicon'></div>	<span>{{title}}</span></div><div class='rowcol2'></div><div class='rowcol3'></div>",t.forumthreadsthreadview="<div class='rowname'>	<span>{{title}}</span></div><div class='rowcol2'></div><div class='rowcol3'></div>",t.forumpost="<div class='subthreadicon'></div><div class='posttitle'>	<div class='posttitlemain'>		<span class='main'>{{ name }}</span>		<span class='dot'>&middot;</span>		<span class='author'>{{ author }}</span>	</div>	<span class='date'>{{ nicedate }}</span></div><div class='postbody'>{{ body }}</div><div class='subthreads'></div>",t.announcementview="<div class='posttitle'>	<div class='posttitlemain'>		<span class='main'>{{ title }}</span>		<span class='dot'>&middot;</span>		<span class='author'>{{ from }}</span>	</div>	<span class='date'>{{ nicedate }}</span></div><div class='postbody'>{{ contents }}</div>",t.inforow="<div class='inforow tabrow'>{{text}}</div>",t.emptyfolder="<div class='folder'>	<span>this folder is empty.</span></div>",t.loadingfolder="<div class='folder'>	<span>loading...</span></div>",t.workbinview="<div class='tabheading' id='workbinheading'></div><div class='tabrowinfo tabrow'>	<div class='rowname'>		<div class='rowicon'></div>		<span>Name</span>	</div>	<div class='rowcol2'>Kind</div>	<div class='rowcol3'>Size</div></div><div id='filescontainer'><div>",t.itemview="<div class='rowname'>	<div class='rowicon {{filetype}}'></div>	<span>{{name}}</span></div><div class='rowcol2'>{{kind}}</div><div class='rowcol3'>{{size}}</div>";var n={};return e.templateSettings={interpolate:/\{\{([\s\S]+?)\}\}/g},e.each(e.keys(t),function(r){n[r]=e.template(t[r])}),n}),define("ivle",["jquery","underscore"],function(e,t){var n=function(e){var t="https://ivle.nus.edu.sg/api/Lapi.svc/",n=function(t,n,r,i,s){e.ajax({type:"GET",dataType:"jsonp",data:n,contentType:"application/x-javascript",url:t,xhrFields:{withCredentials:!1},success:r,error:function(o,u,a){var f=t+"?"+decodeURIComponent(e.param(n));s?e.ajax({type:"POST",dataType:"json",data:{request:f},url:s,dataFilter:function(t){return e.parseJSON(t)},success:r,error:i}):i&&i.apply(this,arguments)}})},r=function(e,r){this.auth=function(t,n){t.click(function(){var t="https://ivle.nus.edu.sg/api/login/?apikey="+e+"&url="+encodeURIComponent(n);window.location.href=t})},this.user=function(i){this.authtoken=i,this.setauthtoken=function(e){this.authtoken=e},this.validate=function(i,s){var o="Validate",u={APIKey:e,Token:this.authtoken,output:"json"},a=t+o;n(a,u,i,s,r)},this.uid=function(i,s){var o="UserID_Get",u={APIKey:e,Token:this.authtoken,output:"json"},a=t+o;n(a,u,i,s,r)},this.uname=function(i,s){var o="UserName_Get",u={APIKey:e,Token:this.authtoken,output:"json"},a=t+o;n(a,u,i,s,r)},this.email=function(i,s){var o="UserEmail_Get",u={APIKey:e,Token:this.authtoken,output:"json"},a=t+o;n(a,u,i,s,r)},this.modules=function(i,s){var o="Modules",u={APIKey:e,AuthToken:this.authtoken,Duration:0,IncludeAllInfo:!1,output:"json"},a=t+o;n(a,u,i,s,r)},this.workbin=function(i,s,o){var u="Workbins",a={APIKey:e,AuthToken:this.authtoken,CourseId:i,Duration:0,TitleOnly:!1,output:"json"},f=t+u;n(f,a,s,o,r)},this.file=function(t){var n="https://ivle.nus.edu.sg/api/downloadfile.ashx?APIKey="+e+"&AuthToken="+this.authtoken+"&ID="+t+"&target=workbin";window.location.href=n},this.announcements=function(i,s,o){var u="Announcements",a={APIKey:e,AuthToken:this.authtoken,CourseId:i,Duration:0,TitleOnly:!1,output:"json"},f=t+u;n(f,a,s,o,r)},this.forums=function(i,s,o){var u="Forums",a={APIKey:e,AuthToken:this.authtoken,CourseId:i,Duration:0,IncludeThreads:!1,TitleOnly:!1,output:"json"},f=t+u;n(f,a,s,o,r)},this.forumheadingthreads=function(i,s,o){var u="Forum_HeadingThreads",a={APIKey:e,AuthToken:this.authtoken,HeadingID:i,Duration:0,GetMainTopicsOnly:!0,output:"json"},f=t+u;n(f,a,s,o,r)},this.forumthread=function(i,s,o){var u="Forum_Threads",a={APIKey:e,AuthToken:this.authtoken,GetSubThreads:!0,Duration:0,ThreadID:i,output:"json"},f=t+u;n(f,a,s,o,r)}}};return r}(e);return n}),define("models",["jquery","underscore","backbone"],function(e,t,n){var r={},i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};return r.readabledate=function(e){var t=Date.now()-e.getTime(),n=Math.round(Math.abs(t)/1e3),r=Math.round(n/60),i=Math.round(r/60),s=Math.round(i/24),o=Math.round(s/365),u=n<45&&"a few seconds"||r===1&&"a minute"||r<45&&r+" minutes"||i===1&&"an hour"||i<22&&i+" hours"||s===1&&"a day"||s<=25&&s+" days"||s<=45&&"a month"||s<345&&Math.round(s/30)+" months"||o===1&&"a year"||o+" years";return u+" ago"},r.nicedate=function(e){var t=e.match(/(\d+)/g),n=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);return n},r.Items=n.Collection.extend({}),r.Folder=n.Model.extend({initialize:function(e,t){this.parent=t,this.set({path:this.get("name")});var n=this.get("count");this.get("folders")&&(n=parseInt(n,10)+this.get("folders").length),n===0?this.set({size:"empty"}):this.set({size:n+" items"}),this.init()},defaults:{name:"",kind:"",size:"",filetype:"",type:""},init:function(){var e=t.map(this.get("files"),function(e){return new r.File(e,this)},this),n=t.map(this.get("folders"),function(e){return new r.Folder(e,this)},this);this.items=new r.Items,this.items.add(n),this.items.add(e)},getlatest:function(){var e=this.toJSON();return e.files=[],e.folders=[],t.each(this.items.models,function(t){t.get("type")==="document"?e.files.push(t.toJSON()):t.get("type")==="folder"&&e.folders.push(t.getlatest())}),e},filepath:function(){var e="",t=this.parent;while(t)e=t.get("name")+"/"+e,t=t.parent;return e+t.get("name")},hasnewfiles:function(){var e=t.filter(this.items.models,function(e){if(e.get("type")==="document")return e.isnotdled();if(e.get("type")==="folder")return e.hasnewfiles()},this);return e.length}}),r.File=n.Model.extend({initialize:function(e,t){this.parent=t,this.set({size:this.calcfilesize(this.get("bytes"))}),this.set({kind:this.get("filetype")+" document"})},defaults:{name:"",kind:"",size:"",filetype:"",type:""},calcfilesize:function(e){var t,n;t=["bytes","KB","MB","GB"],n=0;while(Math.floor(e).toString().length>3)n++,e=parseInt(e,10),e/=1024;return Math.round(e)!==e&&(e=parseFloat(e,10).toFixed(2).toString().slice(0,6)),e+" "+t[n]},dled:function(){this.set({dled:"true"});var e=this.parent;while(e.parent)e=e.parent;e.updateserver()},isnotdled:function(){return!this.get("dled")||this.get("dled")==="false"}}),r.Workbin=n.Model.extend({initialize:function(){this.type="workbin",this.fields(),this.on("change",this.fields,this),t.bindAll(this,"updateserver")},fields:function(){var e=t.map(this.get("folders"),function(e){return new r.Folder(e,this)},this);this.items=new r.Items(e)},setname:function(e){this.set({name:e})},filepath:function(){return this.get("name")},updateserver:function(){var n=this.toJSON();n.folders=t.map(this.items.models,function(e){return e.getlatest()}),e.ajax({type:"POST",url:"/workbin",data:{moduleid:this.get("modid"),workbin:JSON.stringify(n)},success:function(e){},dataType:"json"})}}),r.Announcement=n.Model.extend({initialize:function(e){this.set({path:this.id}),this.get("date")&&this.set({nicedate:r.readabledate(this.get("date"))})},defaults:{title:"",from:"",nicedate:"",contents:""}}),r.Announcements=n.Collection.extend({initialize:function(e){this.loaded=!1},model:r.Announcement,isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),r.Thread=n.Model.extend({initialize:function(e,n){t.bindAll(this,"setthreads","fetch","thinthread"),this.set({path:this.id}),this.parent=n.parent,this.user=n.user,this.type="thread",this.threads=[],this.get("threads")&&this.setthreads(this.get("threads"));var i=this.get("date");typeof i=="string"&&(i=r.nicedate(i)),this.set({nicedate:r.readabledate(i)}),this.loaded=!1},defaults:{name:"",author:"",nicedate:"",body:""},isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0},fetch:function(){var e=this;this.user.forumthread(this.id,function(t){var n=t.Results.length!==0?t.Results[0]:null;n=e.thinthread(n),e.setthreads(n.threads),e.isloaded(),e.trigger("reset")})},setthreads:function(e){e=t.map(e,function(e){var t=new r.Thread(e,{parent:this,user:this.user});return t},this),this.threads=e},thinthread:function(e){if(!e)return;return{id:e.ID,name:e.PostTitle,author:e.Poster.Name,email:e.Poster.Email,uid:e.Poster.UserID,body:e.PostBody,date:r.nicedate(e.PostDate_js),threads:t.map(e.Threads.reverse(),function(e){return this.thinthread(e)},this)}}}),r.Threads=n.Collection.extend({initialize:function(e){this.loaded=e.length===0?!1:!0},model:r.Thread,isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),r.Heading=n.Model.extend({initialize:function(e,n){this.type="heading",this.parent=n.parent,this.user=n.user;var i=[];this.get("threads")&&t.each(this.get("threads"),function(e){var t=new r.Thread(e,{parent:this,user:this.user});i.push(t)},this),this.threads=new r.Threads(i),this.set({path:this.get("name")})},defaults:{name:""},update:function(){var e=this;this.user.forumheadingthreads(this.id,function(n){var i=t.map(n.Results,function(e){return{id:e.ID,name:e.PostTitle,author:e.Poster.Name,email:e.Poster.Email,uid:e.Poster.UserID,body:e.PostBody,date:r.nicedate(e.PostDate_js)}});t.each(i,function(t){var n=new r.Thread(t,{parent:this,user:e.user});e.threads.add(n,{silent:!0})},e),e.threads.isloaded(),e.threads.trigger("reset"),e.updateserver()})},updateserver:function(){e.ajax({type:"POST",url:"/forum/heading",data:{moduleid:this.parent.get("modid"),headingid:this.id,threads:JSON.stringify(this.threads.toJSON())},success:function(e){},dataType:"json"})}}),r.ForumItems=n.Collection.extend({initialize:function(e){this.loaded=e&&e.length===0?!1:!0},isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),r.Forum=n.Model.extend({initialize:function(e,n){this.type="forum",this.user=n.user,this.parent=n.parent,this.items=new r.ForumItems,this.set("name",this.get("title")),this.set({path:this.get("name")}),t.each(this.get("headings"),function(e){var t=new r.Heading(e,{parent:this,user:this.user});this.items.add(t,{silent:!0})},this),t.each(this.get("forums"),function(e){var t=new r.Forum(e,{parent:this,user:this.user});this.items.add(t,{silent:!0})},this),t.bindAll(this,"update")},update:function(e){e.length===1&&(e=e[0],this.set(e),t.each(e.headings,function(e){var t=new r.Heading(e,{parent:this,user:this.user});this.items.add(t,{silent:!0})},this)),e.length>1&&(this.set("modid",e[0].modid),this.set("headings",[]),this.set("forums",e),t.each(e,function(e){var t=new r.Forum(e,{parent:this,user:this.user});this.items.add(t,{silent:!0})},this)),this.items.isloaded(),this.items.trigger("reset")},updateserver:function(){e.ajax({type:"POST",url:"/forum",data:{moduleid:this.get("modid"),forum:JSON.stringify(this.toJSON())},success:function(e){},dataType:"json"})}}),r.Module=n.Model.extend({initialize:function(e,n){this.user=n.user,this.workbin=new r.Workbin(this.get("workbin")),this.workbin.setname(this.get("code")),this.announcements=new r.Announcements(this.get("announcements")),this.forum=new r.Forum(this.get("forum"),{user:this.user}),t.bindAll(this,"fetchworkbin","thinfolder","fetchannouncements")},defaults:{id:"",code:"",name:""},thinfiles:function(e){return t.map(e.reverse(),function(e){var t={};return t.desc=e.FileDescription,t.name=e.FileName,t.bytes=e.FileSize,t.filetype=e.FileType,t.id=e.ID,t.type="document",t.dled=e.isDownloaded?!0:!1,t})},thinfolder:function(e){return t.map(e,function(e){var t={};return t.name=e.FolderName,t.count=e.FileCount,t.files=this.thinfiles(e.Files),t.folders=this.thinfolder(e.Folders),t.id=e.ID,t.type=t.kind="folder",t},this)},thinheadings:function(e){return t.map(e,function(e){return{id:e.ID,name:e.Title,order:e.HeadingOrder}})},fetchworkbin:function(){var e=this;return this.user.workbin(this.id,function(t){t.Results.length===0&&(t.Results[0]={});var n={};n.folders=e.thinfolder(t.Results[0].Folders),n.modid=e.id,n.id=t.Results[0].ID||-1,n.type=n.kind="folder",n.title=t.Results[0].Title,e.workbin.set(n),e.workbin.updateserver()}),this},fetchannouncements:function(){var e=this;return this.user.announcements(this.id,function(n){var i=t.map(n.Results,function(e){var t={};return t.id=e.ID,t.title=e.Title,t.date=r.nicedate(e.CreatedDate_js),t.contents=e.Description,t.from=e.Creator.Name,t},e);e.announcements.isloaded(),e.announcements.add(i,{silent:!0}),e.announcements.trigger("change")}),this},fetchforums:function(){var e=this;return this.user.forums(this.id,function(n){var r=t.map(n.Results,function(t){var n={id:t.ID,modid:e.id,title:t.Title,headings:e.thinheadings(t.Headings)};return n});e.forum.update(r),e.forum.updateserver()}),this}}),r.Modules=n.Collection.extend({initialize:function(e,n){this.user=n.user,t.bindAll(this,"fetch")},model:r.Module,fetch:function(n){var i=this;this.user.modules(function(s){var o=function(e){return t.find(s.Results,function(t){return e.id===t.ID})};t.each(i.models,function(e){o(e)||this.remove(e)},i);var u=t.map(s.Results,function(e){var t={};return t.code=e.CourseCode,t.name=e.CourseName,t.sem=e.CourseSemester,t.year=e.CourseAcadYear,t.id=e.ID,t});t.each(u,function(e){var t=this.get(e.id);if(t)t.set(e,{silent:!0});else{var n=new r.Module(e,{user:this.user});this.add(n,{silent:!0})}},i),i.trigger("reset"),n&&n(),e.ajax({type:"POST",url:"/modules",data:{modules:JSON.stringify(u)},success:function(e){},dataType:"json"})})}}),r}),define("desktop_views",["jquery","underscore","backbone","desktop_ich"],function(e,t,n,r){var i={};return i.MainView=n.View.extend({el:"#main_container",initialize:function(e){this.user=e.user,this.modules=e.modules,t.bindAll(this,"render","moduleselected")},render:function(){return this.modulesview=(new i.ModulesView({collection:this.modules})).render(),this.contentview=(new i.ContentView({user:this.user})).render(),this},events:{moduleselected:"moduleselected"},moduleselected:function(e,t){this.modulesview.active(t.get("code")),this.contentview.changemodule(t);if(e){var n=this.contentview.currentview;this.$el.trigger("navigateto",[t.get("code"),n])}}}),i.ModulesView=n.View.extend({el:"#leftbar",initialize:function(){this.collection.on("reset",this.render,this)},render:function(){this.views=[];var n=document.createDocumentFragment();t.each(this.collection.models,function(e){var t=new i.ModuleView({model:e});this.views.push(t),n.appendChild(t.render().el)},this),this.$el.html(n),this.activemod&&this.active(this.activemod),this.$el.css({width:"auto"});var r=this.$el.width();return r+=10,e("#content").width(960-r),this},active:function(e){this.activemod=e,this.$(".active").removeClass("active"),t.each(this.views,function(t){t.model.get("code")===e&&t.active()},this)},highlight:function(e){this.$(".highlight").removeClass("highlight"),this.views[e].$el.addClass("highlight")}}),i.ModuleView=n.View.extend({className:"moduleview",initialize:function(){},render:function(){return this.$el.html(r.moduleview(this.model.toJSON())),this},events:{click:"moduleselected"},moduleselected:function(){this.$el.trigger("moduleselected",this.model)},active:function(){this.$el.addClass("active")}}),i.ContentView=n.View.extend({el:"#content",initialize:function(e){this.user=e.user,this.module=null,this.defaultview="announcements",this.currentview=this.defaultview,t.bindAll(this,"render","changemodule","changeview")},render:function(){return this.module!==null&&(this.$el.html(r.contentview()),this.contentnav=(new i.ContentNavView({view:this.defaultview})).render(),this.contentcontainer=(new i.ContentContainerView({user:this.user,module:this.module,view:this.defaultview})).render()),this},changemodule:function(e){this.module===null?(this.module=e,this.render()):(this.module=e,this.contentcontainer.changemodule(this.module))},changeview:function(e,t){this.currentview=t,this.contentcontainer.changeview(t),this.contentnav.changeview(t),e&&this.navigate()},navigate:function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this.module.get("code"),this.currentview),this.$el.trigger("navigateto",t)},events:{changeview:"changeview",navigate:"navigate"}}),i.ContentNavView=n.View.extend({el:"#tabs",initialize:function(e){this.views=["announcements","workbin","forum"],this.children=[],this.currentview=e.view},render:function(){var e=document.createDocumentFragment();return t.each(this.views,function(t){var n=new i.ContentNavItemView({name:t});this.children.push(n),e.appendChild(n.render().el)},this),this.$el.html(e),this.changeview(this.currentview),this},changeview:function(e){t.each(this.children,function(t){t.name===e?t.active():t.inactive()},this)}}),i.ContentNavItemView=n.View.extend({tagName:"div",className:"tab",initialize:function(e){this.name=e.name},render:function(){return this.$el.html(this.name),this},events:{click:"changeview"},changeview:function(){this.$el.hasClass("active")||this.$el.trigger("changeview",this.name)},active:function(){this.$el.addClass("active")},inactive:function(){this.$el.removeClass("active")}}),i.ContentContainerView=n.View.extend({el:"#tabcontent",initialize:function(e){this.user=e.user,this.module=e.module,this.currentview=e.view,this.viewobj={}},render:function(){var e=this.view(this.currentview);return this.viewobj=new e({user:this.user,model:this.module}),this.$el.html(this.viewobj.render().el),this},view:function(e){if(e==="workbin")return i.WorkbinView;if(e==="announcements")return i.AnnouncementsView;if(e==="forum")return i.ForumView},changemodule:function(e){this.module=e,this.render()},changeview:function(e){this.currentview=e,this.render()}}),i.Breadcrumb=n.View.extend({className:"breadcrumb",initialize:function(e){this.type=e.type},render:function(){return this.model.type==="thread"?this:(this.model.parent?this.$el.html(r.breadcrumb(this.model.toJSON())):this.$el.html(r.breadcrumbicon({type:this.model.type})),this.$el.addClass(this.type),this)},events:{click:"drilldown"},drilldown:function(){this.type==="parent"&&this.$el.trigger("drilldown",this.model)}}),i.Breadcrumbs=n.View.extend({initialize:function(){},render:function(){var e=this.model.parent;if(!e)return this.$el.hide(),this;while(e){var t=new i.Breadcrumb({model:e,type:"parent"});this.$el.prepend(t.render().el),e=e.parent}var n=new i.Breadcrumb({model:this.model,type:"current"});return this.$el.append(n.render().el),this.$el.addClass("breadcrumbs"),this}}),i.ForumView=n.View.extend({id:"forumcontainer",initialize:function(e){this.user=e.user,this.currentitem=this.model.fetchforums().forum},render:function(){this.$el.html(r.forumview()),this.breadcrumbs=new i.Breadcrumbs({model:this.currentitem,el:this.$("#forumheader")}),this.breadcrumbs.render();if(this.currentitem.type==="forum")this.headingsview=new i.ForumItemsView({model:this.currentitem}),this.$("#forumcontents").html(this.headingsview.render().el);else if(this.currentitem.type==="heading"){var e=new i.ForumThreadsView({model:this.currentitem});this.$("#forumcontents").html(e.render().el)}else if(this.currentitem.type==="thread"){var t=new i.ForumSingleThreadView({model:this.currentitem});this.$(".tabcontents").html(t.render().el)}return this},events:{drilldown:"drilldown"},drilldown:function(e,t){this.currentitem=t,this.render();if(e){var n=[],r=this.currentitem;while(r.parent){var i=r.get("path");n.unshift(i),r=r.parent}this.$el.trigger("navigate",n)}}}),i.ForumItemsView=n.View.extend({initialize:function(){this.model.items.on("reset",this.render,this)},render:function(){if(this.model.items.isloading())this.$el.html(r.inforow({text:"loading..."}));else if(this.model.items.models.length===0)this.$el.html(r.inforow({text:"no headings"}));else{var e=document.createDocumentFragment();t.each(this.model.items.models,function(t){var n=new i.ForumItemView({model:t});e.appendChild(n.render().el)}),this.$el.html(e)}return this}}),i.ForumThreadsView=n.View.extend({initialize:function(){this.model.update(),this.model.threads.on("reset",this.render,this)},render:function(){if(this.model.threads.isloading())this.$el.html(r.inforow({text:"loading..."}));else if(this.model.threads.models.length===0)this.$el.html(r.inforow({text:"zero threads :("}));else{var e=document.createDocumentFragment();t.each(this.model.threads.models,function(t){var n=new i.ForumItemView({model:t});e.appendChild(n.render().el)}),this.$el.html(e)}return this}}),i.ForumItemView=n.View.extend({className:"tabrow itemview",initialize:function(){},render:function(){return this.model.type==="heading"?this.$el.html(r.forumheadingview(this.model.toJSON())):this.model.type==="thread"?this.$el.html(r.forumthreadview(this.model.toJSON())):this.model.type==="forum"&&this.$el.html(r.forumforumview(this.model.toJSON())),this},events:{click:"drilldown"},drilldown:function(){this.$el.trigger("drilldown",this.model)}}),i.ForumSingleThreadView=n.View.extend({id:"forumsinglethreadview",initialize:function(){this.model.fetch(),this.model.on("reset",this.render,this)},render:function(){var e;return this.model.isloading()?(e=new i.ForumSingleThreadThreadView({model:this.model,root:!0,loading:!0}),this.$el.html(e.render().el)):(e=new i.ForumSingleThreadThreadView({model:this.model,root:!0}),this.$el.html(e.render().el)),this}}),i.ForumSingleThreadThreadView=n.View.extend({className:"tabpost forumpost",initialize:function(e){this.root=e.root,this.loading=e.loading},render:function(){return this.$el.html(r.forumpost(this.model.toJSON())),this.loading?this.$el.append(r.inforow({text:"loading entire thread..."})):(this.model.threads.length!==0&&t.each(this.model.threads,function(e){var t=new i.ForumSingleThreadThreadView({model:e});this.$(".subthreads").append(t.render().el)},this),this.root&&this.$el.append(r.inforow({text:"end of thread."}))),this}}),i.AnnouncementsView=n.View.extend({className:"announcementsview",tagName:"div",initialize:function(e){this.user=e.user,this.announcements=this.model.fetchannouncements().announcements,this.announcements.on("change",this.render,this)},render:function(){if(this.announcements.isloading())this.$el.html(r.inforow({text:"loading..."}));else if(this.announcements.models.length===0)this.$el.html(r.inforow({text:"no announcements."}));else{var e=document.createDocumentFragment();t.each(this.announcements.models,function(t){var n=new i.AnnouncementView({model:t});e.appendChild(n.render().el)},this),this.$el.html(e)}return this}}),i.AnnouncementView=n.View.extend({tagName:"div",className:"announcementview tabpost",initialize:function(e){},render:function(){return this.$el.html(r.announcementview(this.model.toJSON())),this}}),i.WorkbinView=n.View.extend({initialize:function(e){this.user=e.user,this.currentitem=this.model.fetchworkbin().workbin,this.currentitem.on("all",this.render,this)},render:function(){this.$el.html(r.workbinview()),this.breadcrumbs=new i.Breadcrumbs({model:this.currentitem,el:this.$("#workbinheading")}),this.breadcrumbs.render();if(typeof this.currentitem.get("id")!="undefined")if(this.currentitem.items.models.length===0)this.$("#filescontainer").html(r.emptyfolder());else{var e=document.createDocumentFragment();this.elems=[],t.each(this.currentitem.items.models,function(t){var n;t.get("type")==="document"?n=new i.FileView({model:t}):t.get("type")==="folder"&&(n=new i.FolderView({model:t})),this.elems.push(n),e.appendChild(n.render().el)},this),this.$("#filescontainer").html(e)}else this.$("#filescontainer").html(r.loadingfolder());return this},events:{drilldown:"drilldown",downloadfile:"downloadfile"},drilldown:function(e,t){this.currentitem=t,this.render();if(e){var n=[],r=this.currentitem;while(r.parent){var i=r.get("path");n.unshift(i),r=r.parent}this.$el.trigger("navigate",n)}},downloadfile:function(e,t){this.user.file(t.id),setTimeout(function(){t.isnotdled()&&t.dled()},500)},highlight:function(e){this.$(".highlight").removeClass("highlight"),this.elems[e].$el.addClass("highlight")}}),i.FileView=n.View.extend({className:"tabrow itemview fileview",initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.$el.html(r.itemview(this.model.toJSON())),this.itemicon(),this.model.isnotdled()&&this.$(".rowicon").append("<div class='notification'>1</div>"),this},itemicon:function(){var e=this.model.get("filetype"),n={zip:"zip",doc:"doc",docx:"doc",pdf:"pdf",ppt:"ppt",pptx:"ppt",xls:"xls",xlsx:"xlsx",acc:"acc",avi:"avi",bmp:"bmp",c:"c",cpp:"cpp",dmg:"dmg",exe:"exe",flv:"flv",gif:"gif",h:"h",html:"html",ics:"ics",java:"java",jpg:"jpg",key:"key",mp3:"mp3",mid:"mid",mp4:"mp4",mpg:"mpg",php:"php",png:"png",psd:"psd",py:"py",qt:"qt",rar:"rar",rb:"rb",rtf:"rtf",sql:"sql",tiff:"tiff",txt:"txt",wav:"wav",xml:"xml"},r="_blank",i=t.has(n,e)?n[e]:r;i="url(/img/filetypes/"+i+".png)",this.$(".rowicon").css("background-image",i)},events:{click:"downloadfile"},downloadfile:function(){this.$el.trigger("downloadfile",this.model)}}),i.FolderView=n.View.extend({className:"tabrow itemview folderview",initialize:function(){t.bindAll(this,"drilldown")},render:function(){this.$el.html(r.itemview(this.model.toJSON()));var e=this.model.hasnewfiles();return e&&(e=e>10?"10+":e,this.$(".rowicon").append("<div class='notification'>"+e+"</div>")),this},events:{click:"drilldown"},drilldown:function(){this.$el.trigger("drilldown",this.model)}}),i}),function(e,t){typeof define=="function"&&define.amd?define("keyboardjs",[],t):e.KeyboardJS=t()}(this,function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,function(t){return n.call(e,t)})}function o(){var e=[];for(var t=s.length;t>-1;t-=1)if(s[t]){var n=s[t];for(var i=0;i<n.length;i+=1){var o=n[i],u=!0;for(var a=0;a<o.keys.length;a+=1){var f=o.keys[a];r.indexOf(f)<0&&(u=!1)}u&&e.push(o)}}return e}function u(e){if(r<1)return!0;var t=o(),n=[],s;for(var u=0;u<t.length;u+=1){var a=t[u],f=!1;for(var l=0;l<a.keys.length;l+=1){var c=a.keys[l];if(n.indexOf(c)>-1){f=!0;break}}if(!f){typeof a.callback=="function"&&(a.callback(e,a.keys,a.keyCombo)||(s=!1)),i[a.keyCombo]||(i[a.keyCombo]=a);for(var l=0;l<a.keys.length;l+=1){var c=a.keys[l];n.indexOf(c)<0&&n.push(c)}}}return n.length?!1:s}function a(e){var t=o(),n;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],u=!1;for(var a=0;a<t.length;a+=1){var f=t[a].keyCombo;if(f===r){u=!0;break}}u||(typeof s.endCallback=="function"&&(s.endCallback(e,s.keys,s.keyCombo)||(n=!1)),delete i[r])}return n}function f(e,t,n){function r(){if(u&&u.length){var e=s[u.length];if(e.indexOf(a)>-1){var t=s[u.length].indexOf(a);s[u.length].splice(t,1)}}}var i=e.toLowerCase().replace(/\s/g,"").split(",");for(var o=0;o<i.length;o+=1){var u=i[o].split("+");if(u.length){s[u.length]||(s[u.length]=[]);var a={callback:t,endCallback:n,keyCombo:i[o],keys:u};s[u.length].push(a)}}return{clear:r}}function l(e,t,n,r,i){function s(){typeof u=="function"&&u(),typeof a=="function"&&a(),typeof l=="function"&&l(),typeof c=="function"&&c(),typeof h=="function"&&clearInterval(h)}var o=[0,0];if(typeof i!="function")return!1;var u=f(e,function(){o[0]===0&&(o[0]=-1)},function(){o[0]=0}).clear,a=f(t,function(){o[0]===0&&(o[0]=1)},function(){o[0]=0}).clear,l=f(n,function(){o[1]===0&&(o[1]=-1)},function(){o[1]=0}).clear,c=f(r,function(){o[1]===0&&(o[1]=1)},function(){o[1]=0}).clear,h=setInterval(function(){if(o[0]===0&&o[1]===0)return;i(o)},1);return{clear:s}}function c(e){if(e==="all"){s=[];return}e=e.replace(/\s/g,"").split(",");for(var t=s.length;t>-1;t-=1)if(s[t]){var n=s[t];for(var r=0;r<n.length;r+=1){var i=n[r],o=!1;for(var u=0;u<i.keys.length;u+=1){var a=i.keys[u];for(var f=0;f<e.length;f+=1){var l=e[f];if(l===a){o=!0;break}}if(o)break}o&&(s[t].splice(r,1),r-=1,s[t].length<1&&delete s[t])}}}function h(){return r}function p(e,n){t[e]=n}function d(e){t[e]&&(n=t[e])}[].indexOf||(Array.prototype.indexOf=function(e,t,n){for(n=this.length,t=(n+~~t)%n;t<n&&(!(t in this)||this[t]!==e);t++);return t^n?t:-1});var t={us:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,"break":19,capslock:20,escape:27,esc:27,space:32,spacebar:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,windows:91,win:91,_91:92,select:93,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,num:144,scrolllock:145,scroll:145,semicolon:186,equal:187,equalsign:187,comma:188,dash:189,period:190,slash:191,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222}},n=t.us,r=[],i={},s=[];return e(document,"keydown",function(e){for(var t in n)n.hasOwnProperty(t)&&e.keyCode===n[t]&&r.indexOf(t)<0&&r.push(t);return u(e)}),e(document,"keyup",function(e){for(var t in n)if(n.hasOwnProperty(t)&&e.keyCode===n[t]){var i=r.indexOf(t);i>-1&&r.splice(i,1)}return a(e)}),{bind:{key:f,axis:l},activeKeys:h,unbind:{key:c},locale:{add:p,set:d}}}),define("desktop_app",["jquery","underscore","backbone","desktop_ich","ivle","models","desktop_views","keyboardjs"],function(e,t,n,r,i,s,o,u){var a=function(e,t){u.bind.key(e,t,function(){})},f=n.View.extend({el:"#container",initialize:function(e){this.parent=e.parent,this.shortcuts(),this.resetstate()},shortcuts:function(){var t=this;a("shift + slash",function(){e("#overlay").html(r.keyboardshortcuts()).show(),e("#overlay_close").click(function(){e("#overlay").html("").hide()})}),a("esc",function(){e("#overlay").html("").hide()}),a("g + a",function(){t.currentview="announcements",t.parent.mainview.contentview.changeview(null,t.currentview)}),a("g + w",function(){t.currentview="workbin",t.parent.mainview.contentview.changeview(null,t.currentview)}),a("g + f",function(){t.currentview="forum",console.log("asdf"),t.parent.mainview.contentview.changeview(null,t.currentview)}),a("g + m",function(){t.currentview="modules"}),a("j",function(){t.up()}),a("k",function(){t.down()}),a("enter",function(){t.select()})},events:{},resetstate:function(e,t){this.currentview=e||"modules",this.currentindex=t},incrindex:function(){return typeof this.currentindex!="number"?this.currentindex=0:this.currentindex+=1,this.padindex(),this.currentindex},decrindex:function(){return typeof this.currentindex!="number"?this.currentindex=0:this.currentindex-=1,this.padindex(),this.currentindex},up:function(){var e=this.incrindex();this.highlight(e)},down:function(){var e=this.decrindex();this.highlight(e)},select:function(){var e=this.viewcollection(),t=this.currentindex||0;if(this.currentview==="modules"){var n=e[t];this.parent.mainview.moduleselected({},n)}},viewcollection:function(){var e,t;return this.currentview==="modules"?e=this.parent.mainview.modulesview.collection.models:this.currentview==="forum"?(t=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,t.type==="forum"?e=t.headings.models:t.type==="heading"?e=t.threads.models:t.type==="thread"&&(e="dontloop")):this.currentview==="workbin"?(t=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,e=t.items.models):this.currentview==="announcements"&&(e=this.parent.mainview.contentview.contentcontainer.viewobj.announcements.models),e},highlightobj:function(){var e,t;return this.currentview==="modules"?e=this.parent.mainview.modulesview:this.currentview==="forum"?(t=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,t.type==="forum"?e=t.headings.models:t.type==="heading"?e=t.threads.models:t.type==="thread"&&(e="dontloop")):this.currentview==="workbin"?e=this.parent.mainview.contentview.contentcontainer.viewobj:this.currentview==="announcements"&&(e=this.parent.mainview.contentview.contentcontainer.viewobj.announcements.models),e},highlight:function(){this.highlightobj().highlight(this.currentindex)},padindex:function(){this.currentindex>=0?this.currentindex%=this.lengthofview():this.currentindex=this.lengthofview()+this.currentindex},lengthofview:function(){var e=this.viewcollection(this.currentview),t=e==="dontloop"?this.currentindex+1:e.length;return t}}),l=n.Router.extend({initialize:function(e){this.parent=e.parent},routes:{":mod/workbin*stuff":"workbin",":mod/announcements":"announcements",":mod/forum*stuff":"forum","*mod":"module"},module:function(e){var t=this.checkmod(e);t?(this.parent.mainview.moduleselected(null,t),mixpanel.track("Router triggered",{type:"module",route:e})):this.navigate("")},workbin:function(e,n){var r=this.checkmod(e);if(!r)return this.navigate("");if(n){mixpanel.track("Router triggered",{type:"workbin",route:n});var i=n.split("/").slice(1),s,o=r.workbin;while(i.length!==0){s=t.find(o.items.models,function(e){return this.sanitize(e.get("path"))===i[0]},this);if(!s)break;o=s,i=i.slice(1)}if(!s)return this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"workbin"),this.navigateto(r.get("code"),"workbin");this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"workbin"),this.parent.mainview.contentview.contentcontainer.viewobj.drilldown(null,s)}else this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"workbin")},announcements:function(e){var t=this.checkmod(e);if(!t)return this.navigate("");this.parent.mainview.moduleselected(null,t),this.parent.mainview.contentview.changeview(null,"announcements"),mixpanel.track("Router triggered",{type:"announcements",route:e+"/announcements"})},forum:function(e,n){var r=this.checkmod(e);if(!r)return this.navigate("");if(n){mixpanel.track("Router triggered",{type:"forum",route:n});var i=n.split("/").slice(1),s,o=r.forum;while(i.length!==0){var u=o.items||o.threads;s=t.find(u.models,function(e){return this.sanitize(e.get("path"))===i[0]},this);if(!s)break;o=s,i=i.slice(1)}if(!s)return this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"forum"),this.navigateto(r.get("code"),"forum");this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"forum"),this.parent.mainview.contentview.contentcontainer.viewobj.drilldown(null,s)}else this.parent.mainview.moduleselected(null,r),this.parent.mainview.contentview.changeview(null,"forum")},checkmod:function(e){return t.find(this.parent.modules.models,function(t){return this.sanitize(t.get("code"))===this.sanitize(e.toLowerCase())},this)},sanitize:function(e){return e.replace(/\//g,"-").replace(/ /g,"").toLowerCase()},navigateto:function(){var e=t.map(arguments,function(e){return this.sanitize(e)},this),n=e[1];mixpanel.track(n+" tabview",{module:e[0]}),this.navigate(e.join("/")),this.trackpageview()},trackpageview:function(){var e=n.history.getFragment();_gaq.push(["_trackPageview","/"+e])}}),c=n.View.extend({el:"#container",initialize:function(){var e="ba1ge5NQ9cl76KQNI1Suc";this.ivle=new i(e,"/proxy/"),this.modules={},this.router=new l({parent:this}),t.bindAll(this,"start")},start:function(){this.bootstrap=bootstrap,this.usertoken=this.bootstrap.token,this.user=new this.ivle.user(this.usertoken);var e=this;if(this.bootstrap.modules){var r=t.map(this.bootstrap.modules,function(e){var t=new s.Module(e,{user:this.user});return t},this);this.modules=new s.Modules(r,{user:this.user}),this.modules.fetch()}else this.loading(),this.modules=new s.Modules([],{user:this.user}),this.modules.fetch(function(){e.stoploading()});this.render(),this.validateuser(),n.history.start({pushState:!0})},validateuser:function(){var t=this;this.user.validate(function(n){if(n.Success!==!1){n.Token!==t.usertoken&&(t.usertoken=n.Token,t.user.setauthtoken(t.usertoken),t.modules.fetch());var r=/^\/Date\((.*)+.*\)\//,i=r.exec(n.ValidTill),s=i?new Date(parseInt(i[1],10)):i;s&&(s!==t.bootstrap.date||t.usertoken!==t.bootstrap.token)&&e.ajax({type:"POST",url:"/auth",data:{token:t.usertoken,date:s},success:function(e){},dataType:"json"})}},function(){});var n=this.bootstrap.user;n?(mixpanel.identify(n.uid),mixpanel.people.set({$last_login:new Date})):t.user.uid(function(n){t.user.email(function(r){t.user.uname(function(i){e.ajax({type:"POST",url:"/user",data:{uid:n,email:r},success:function(e){},dataType:"json"}),t.bootstrap.user={uname:i,uid:n,email:r},mixpanel.identify(n),mixpanel.people.set({$name:i,$email:r,$created:new Date,$last_login:new Date})})})})},loading:function(){e("#overlay").html(r.loading()).show();var t=this;e("#overlay_close").click(function(){t.stoploading()})},stoploading:function(){e("#overlay").html("").hide()},render:function(){this.mainview=new o.MainView({user:this.user,modules:this.modules}),this.mainview.render()},logout:function(){var e=new RegExp("^(.+"+window.location.host+")"),t=e.exec(window.location.href)[1]+"/logout";window.location.href=t},navigateto:function(e){var t=Array.prototype.slice.call(arguments,1);this.router.navigateto.apply(this.router,t)},events:{"click #logout":"logout",navigateto:"navigateto",downloadfile:"downloadfile"},downloadfile:function(){mixpanel.track("File downloaded")}});return c}),require.config({paths:{jquery:"libs/zeptowrapper",underscore:"libs/underscore",backbone:"libs/backbone",keyboardjs:"libs/keyboard",ivle:"libs/ivle",desktop_app:"scripts/desktop_app",desktop_views:"scripts/desktop_views",desktop_ich:"templates/desktop",models:"scripts/models"}}),require(["desktop_app"],function(e){var t=new e;t.start()}),define("desktop_main",function(){})})()