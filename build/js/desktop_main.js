/**
 * @license RequireJS text 1.0.2 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */
/*!
 * KeyboardJS
 * 
 * Copyright 2011, Robert William Hurst
 * Licenced under the BSD License.
 * See https://raw.github.com/RobertWHurst/KeyboardJS/master/license.txt
 */
(function(){var requirejs,require,define;(function(a){function i(a,b){var c=b&&b.split("/"),e=d.map,f=e&&e["*"]||{},g,h,i,j,k,l,m;if(a&&a.charAt(0)==="."&&b){c=c.slice(0,c.length-1),a=c.concat(a.split("/"));for(k=0;m=a[k];k++)if(m===".")a.splice(k,1),k-=1;else if(m==="..")if(k!==1||a[2]!==".."&&a[0]!=="..")k>0&&(a.splice(k-1,2),k-=2);else return!0;a=a.join("/")}if((c||f)&&e){g=a.split("/");for(k=g.length;k>0;k-=1){h=g.slice(0,k).join("/");if(c)for(l=c.length;l>0;l-=1){i=e[c.slice(0,l).join("/")];if(i){i=i[h];if(i){j=i;break}}}j=j||f[h];if(j){g.splice(0,k,j),a=g.join("/");break}}}return a}function j(b,c){return function(){return h.apply(a,f.call(arguments,0).concat([b,c]))}}function k(a){return function(b){return i(b,a)}}function l(a){return function(c){b[a]=c}}function m(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e[d]=!0,g.apply(a,f)}if(!b.hasOwnProperty(d))throw new Error("No "+d);return b[d]}function n(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=i(a.slice(0,e),b),a=a.slice(e+1),d=m(c),d&&d.normalize?a=d.normalize(a,k(b)):a=i(a,b)):a=i(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function o(a){return function(){return d&&d.config&&d.config[a]||{}}}var b={},c={},d={},e={},f=[].slice,g,h;g=function(d,f,g,h){var i=[],k,p,q,r,s,t;h=h||d;if(typeof g=="function"){f=!f.length&&g.length?["require","exports","module"]:f;for(t=0;t<f.length;t++){s=n(f[t],h),q=s.f;if(q==="require")i[t]=j(d);else if(q==="exports")i[t]=b[d]={},k=!0;else if(q==="module")p=i[t]={id:d,uri:"",exports:b[d],config:o(d)};else if(b.hasOwnProperty(q)||c.hasOwnProperty(q))i[t]=m(q);else if(s.p)s.p.load(s.n,j(h,!0),l(q),{}),i[t]=b[q];else if(!e[q])throw new Error(d+" missing "+q)}r=g.apply(b[d],i);if(d)if(p&&p.exports!==a&&p.exports!==b[d])b[d]=p.exports;else if(r!==a||!k)b[d]=r}else d&&(b[d]=g)},requirejs=require=h=function(b,c,e,f){return typeof b=="string"?m(n(b,c).f):(b.splice||(d=b,c.splice?(b=c,c=e,e=null):b=a),c=c||function(){},f?g(a,b,c,e):setTimeout(function(){g(a,b,c,e)},15),h)},h.config=function(a){return d=a,h},define=function(a,b,d){b.splice||(d=b,b=[]),c[a]=[a,b,d]},define.amd={jQuery:!0}})(),define("libs/almond",function(){}),function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)f=arguments[1];else do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0);while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})}();var Zepto=function(){function A(a){return v.call(a)=="[object Function]"}function B(a){return a instanceof Object}function C(b){var c,d;if(v.call(b)!=="[object Object]")return!1;d=A(b.constructor)&&b.constructor.prototype;if(!d||!hasOwnProperty.call(d,"isPrototypeOf"))return!1;for(c in b);return c===a||hasOwnProperty.call(b,c)}function D(a){return a instanceof Array}function E(a){return typeof a.length=="number"}function F(b){return b.filter(function(b){return b!==a&&b!==null})}function G(a){return a.length>0?[].concat.apply([],a):a}function H(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function I(a){return a in i?i[a]:i[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function J(a,b){return typeof b=="number"&&!k[H(a)]?b+"px":b}function K(a){var b,c;return h[a]||(b=g.createElement(a),g.body.appendChild(b),c=j(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),h[a]=c),h[a]}function L(b,d){return d===a?c(b):c(b).filter(d)}function M(a,b,c,d){return A(b)?b.call(a,c,d):b}function N(a,b,d){var e=a%2?b:b.parentNode;e?e.insertBefore(d,a?a==1?e.firstChild:a==2?b:null:b.nextSibling):c(d).remove()}function O(a,b){b(a);for(var c in a.childNodes)O(a.childNodes[c],b)}var a,b,c,d,e=[],f=e.slice,g=window.document,h={},i={},j=g.defaultView.getComputedStyle,k={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},l=/^\s*<(\w+|!)[^>]*>/,m=[1,3,8,9,11],n=["after","prepend","before","append"],o=g.createElement("table"),p=g.createElement("tr"),q={tr:g.createElement("tbody"),tbody:o,thead:o,tfoot:o,td:p,th:p,"*":g.createElement("div")},r=/complete|loaded|interactive/,s=/^\.([\w-]+)$/,t=/^#([\w-]+)$/,u=/^[\w-]+$/,v={}.toString,w={},x,y,z=g.createElement("div");return w.matches=function(a,b){if(!a||a.nodeType!==1)return!1;var c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(c)return c.call(a,b);var d,e=a.parentNode,f=!e;return f&&(e=z).appendChild(a),d=~w.qsa(e,b).indexOf(a),f&&z.removeChild(a),d},x=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},y=function(a){return a.filter(function(b,c){return a.indexOf(b)==c})},w.fragment=function(b,d){d===a&&(d=l.test(b)&&RegExp.$1),d in q||(d="*");var e=q[d];return e.innerHTML=""+b,c.each(f.call(e.childNodes),function(){e.removeChild(this)})},w.Z=function(a,b){return a=a||[],a.__proto__=arguments.callee.prototype,a.selector=b||"",a},w.isZ=function(a){return a instanceof w.Z},w.init=function(b,d){if(!b)return w.Z();if(A(b))return c(g).ready(b);if(w.isZ(b))return b;var e;if(D(b))e=F(b);else if(C(b))e=[c.extend({},b)],b=null;else if(m.indexOf(b.nodeType)>=0||b===window)e=[b],b=null;else if(l.test(b))e=w.fragment(b.trim(),RegExp.$1),b=null;else{if(d!==a)return c(d).find(b);e=w.qsa(g,b)}return w.Z(e,b)},c=function(a,b){return w.init(a,b)},c.extend=function(c){return f.call(arguments,1).forEach(function(d){for(b in d)d[b]!==a&&(c[b]=d[b])}),c},w.qsa=function(a,b){var c;return a===g&&t.test(b)?(c=a.getElementById(RegExp.$1))?[c]:e:a.nodeType!==1&&a.nodeType!==9?e:f.call(s.test(b)?a.getElementsByClassName(RegExp.$1):u.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},c.isFunction=A,c.isObject=B,c.isArray=D,c.isPlainObject=C,c.inArray=function(a,b,c){return e.indexOf.call(b,a,c)},c.trim=function(a){return a.trim()},c.uuid=0,c.map=function(a,b){var c,d=[],e,f;if(E(a))for(e=0;e<a.length;e++)c=b(a[e],e),c!=null&&d.push(c);else for(f in a)c=b(a[f],f),c!=null&&d.push(c);return G(d)},c.each=function(a,b){var c,d;if(E(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},c.fn={forEach:e.forEach,reduce:e.reduce,push:e.push,indexOf:e.indexOf,concat:e.concat,map:function(a){return c.map(this,function(b,c){return a.call(b,c,b)})},slice:function(){return c(f.apply(this,arguments))},ready:function(a){return r.test(g.readyState)?a(c):g.addEventListener("DOMContentLoaded",function(){a(c)},!1),this},get:function(b){return b===a?f.call(this):this[b]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return this.forEach(function(b,c){a.call(b,c,b)}),this},filter:function(a){return c([].filter.call(this,function(b){return w.matches(b,a)}))},add:function(a,b){return c(y(this.concat(c(a,b))))},is:function(a){return this.length>0&&w.matches(this[0],a)},not:function(b){var d=[];if(A(b)&&b.call!==a)this.each(function(a){b.call(this,a)||d.push(this)});else{var e=typeof b=="string"?this.filter(b):E(b)&&A(b.item)?f.call(b):c(b);this.forEach(function(a){e.indexOf(a)<0&&d.push(a)})}return c(d)},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!B(a)?a:c(a)},last:function(){var a=this[this.length-1];return a&&!B(a)?a:c(a)},find:function(a){var b;return this.length==1?b=w.qsa(this[0],a):b=this.map(function(){return w.qsa(this,a)}),c(b)},closest:function(a,b){var d=this[0];while(d&&!w.matches(d,a))d=d!==b&&d!==g&&d.parentNode;return c(d)},parents:function(a){var b=[],d=this;while(d.length>0)d=c.map(d,function(a){if((a=a.parentNode)&&a!==g&&b.indexOf(a)<0)return b.push(a),a});return L(b,a)},parent:function(a){return L(y(this.pluck("parentNode")),a)},children:function(a){return L(this.map(function(){return f.call(this.children)}),a)},siblings:function(a){return L(this.map(function(a,b){return f.call(b.parentNode.children).filter(function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return this.map(function(){return this[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),j(this,"").getPropertyValue("display")=="none"&&(this.style.display=K(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){return this.each(function(){c(this).wrapAll(c(a)[0].cloneNode(!1))})},wrapAll:function(a){return this[0]&&(c(this[0]).before(a=c(a)),a.append(this)),this},unwrap:function(){return this.parent().each(function(){c(this).replaceWith(c(this).children())}),this},clone:function(){return c(this.map(function(){return this.cloneNode(!0)}))},hide:function(){return this.css("display","none")},toggle:function(b){return(b===a?this.css("display")=="none":b)?this.show():this.hide()},prev:function(){return c(this.pluck("previousElementSibling"))},next:function(){return c(this.pluck("nextElementSibling"))},html:function(b){return b===a?this.length>0?this[0].innerHTML:null:this.each(function(a){var d=this.innerHTML;c(this).empty().append(M(this,b,a,d))})},text:function(b){return b===a?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=b})},attr:function(c,d){var e;return typeof c=="string"&&d===a?this.length==0||this[0].nodeType!==1?a:c=="value"&&this[0].nodeName=="INPUT"?this.val():!(e=this[0].getAttribute(c))&&c in this[0]?this[0][c]:e:this.each(function(a){if(this.nodeType!==1)return;if(B(c))for(b in c)this.setAttribute(b,c[b]);else this.setAttribute(c,M(this,d,a,this.getAttribute(c)))})},removeAttr:function(a){return this.each(function(){this.nodeType===1&&this.removeAttribute(a)})},prop:function(b,c){return c===a?this[0]?this[0][b]:a:this.each(function(a){this[b]=M(this,c,a,this[b])})},data:function(b,c){var d=this.attr("data-"+H(b),c);return d!==null?d:a},val:function(b){return b===a?this.length>0?this[0].value:a:this.each(function(a){this.value=M(this,b,a,this.value)})},offset:function(){if(this.length==0)return null;var a=this[0].getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,width:a.width,height:a.height}},css:function(c,d){if(d===a&&typeof c=="string")return this.length==0?a:this[0].style[x(c)]||j(this[0],"").getPropertyValue(c);var e="";for(b in c)typeof c[b]=="string"&&c[b]==""?this.each(function(){this.style.removeProperty(H(b))}):e+=H(b)+":"+J(b,c[b])+";";return typeof c=="string"&&(d==""?this.each(function(){this.style.removeProperty(H(c))}):e=H(c)+":"+J(c,d)),this.each(function(){this.style.cssText+=";"+e})},index:function(a){return a?this.indexOf(c(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return this.length<1?!1:I(a).test(this[0].className)},addClass:function(a){return this.each(function(b){d=[];var e=this.className,f=M(this,a,b,e);f.split(/\s+/g).forEach(function(a){c(this).hasClass(a)||d.push(a)},this),d.length&&(this.className+=(e?" ":"")+d.join(" "))})},removeClass:function(b){return this.each(function(c){if(b===a)return this.className="";d=this.className,M(this,b,c,d).split(/\s+/g).forEach(function(a){d=d.replace(I(a)," ")}),this.className=d.trim()})},toggleClass:function(b,d){return this.each(function(e){var f=M(this,b,e,this.className);(d===a?!c(this).hasClass(f):d)?c(this).addClass(f):c(this).removeClass(f)})}},["width","height"].forEach(function(b){c.fn[b]=function(d){var e,f=b.replace(/./,function(a){return a[0].toUpperCase()});return d===a?this[0]==window?window["inner"+f]:this[0]==g?g.documentElement["offset"+f]:(e=this.offset())&&e[b]:this.each(function(a){var e=c(this);e.css(b,M(this,d,a,e[b]()))})}}),n.forEach(function(a,b){c.fn[a]=function(){var a=c.map(arguments,function(a){return B(a)?a:w.fragment(a)});if(a.length<1)return this;var d=this.length,e=d>1,f=b<2;return this.each(function(c,g){for(var h=0;h<a.length;h++){var i=a[f?a.length-h-1:h];O(i,function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&window.eval.call(window,a.innerHTML)}),e&&c<d-1&&(i=i.cloneNode(!0)),N(b,g,i)}})},c.fn[b%2?a+"To":"insert"+(b?"Before":"After")]=function(b){return c(b)[a](this),this}}),w.Z.prototype=c.fn,w.camelize=x,w.uniq=y,c.zepto=w,c}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function f(a){return a._zid||(a._zid=d++)}function g(a,b,d,e){b=h(b);if(b.ns)var g=i(b.ns);return(c[f(a)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||g.test(a.ns))&&(!d||f(a.fn)===f(d))&&(!e||a.sel==e)})}function h(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function i(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function j(b,c,d){a.isObject(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function k(b,d,e,g,i,k){k=!!k;var l=f(b),m=c[l]||(c[l]=[]);j(d,e,function(c,d){var e=i&&i(d,c),f=e||d,j=function(a){var c=f.apply(b,[a].concat(a.data));return c===!1&&a.preventDefault(),c},l=a.extend(h(c),{fn:d,proxy:j,sel:g,del:e,i:m.length});m.push(l),b.addEventListener(l.e,j,k)})}function l(a,b,d,e){var h=f(a);j(b||"",d,function(b,d){g(a,b,d,e).forEach(function(b){delete c[h][b.i],a.removeEventListener(b.e,b.proxy,!1)})})}function p(b){var c=a.extend({originalEvent:b},b);return a.each(o,function(a,d){c[a]=function(){return this[d]=m,b[a].apply(b,arguments)},c[d]=n}),c}function q(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var b=a.zepto.qsa,c={},d=1,e={};e.click=e.mousedown=e.mouseup=e.mousemove="MouseEvents",a.event={add:k,remove:l},a.proxy=function(b,c){if(a.isFunction(b)){var d=function(){return b.apply(c,arguments)};return d._zid=f(b),d}if(typeof c=="string")return a.proxy(b[c],b);throw new TypeError("expected function")},a.fn.bind=function(a,b){return this.each(function(){k(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){l(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){k(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return l(d,b,a),c}})})};var m=function(){return!0},n=function(){return!1},o={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){var e=!1;if(c=="blur"||c=="focus")a.iswebkit?c=c=="blur"?"focusout":c=="focus"?"focusin":c:e=!0;return this.each(function(f,g){k(g,c,d,b,function(c){return function(d){var e,f=a(d.target).closest(b,g).get(0);if(f)return e=a.extend(p(d),{currentTarget:f,liveFired:g}),c.apply(f,[e].concat([].slice.call(arguments,1)))}},e)})},a.fn.undelegate=function(a,b,c){return this.each(function(){l(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return c==undefined||a.isFunction(c)?this.bind(b,c):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return c==undefined||a.isFunction(c)?this.unbind(b,c):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){return typeof b=="string"&&(b=a.Event(b)),q(b),b.data=c,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,c){var d,e;return this.each(function(f,h){d=p(typeof b=="string"?a.Event(b):b),d.data=c,d.target=h,a.each(g(h,b.type||b),function(a,b){e=b.proxy(d);if(d.isImmediatePropagationStopped())return!1})}),e},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){if(a)this.bind(b,a);else if(this.length)try{this.get(0)[b]()}catch(c){}return this}}),a.Event=function(a,b){var c=document.createEvent(e[a]||"Events"),d=!0;if(b)for(var f in b)f=="bubbles"?d=!!b[f]:c[f]=b[f];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c}}(Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/Kindle\/([\d.]+)/),k=a.match(/Silk\/([\d._]+)/),l=a.match(/(BlackBerry).*Version\/([\d.]+)/);if(c.webkit=!!d)c.version=d[1];e&&(b.android=!0,b.version=e[2]),g&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,".")),f&&(b.ios=b.ipad=!0,b.version=f[2].replace(/_/g,".")),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),l&&(b.blackberry=!0,b.version=l[2]),j&&(b.kindle=!0,b.version=j[1]),k&&(c.silk=!0,c.version=k[1]),!k&&b.android&&a.match(/Kindle Fire/)&&(c.silk=!0)}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a,b){function l(a){return a.toLowerCase()}function m(a){return d?d+a:l(a)}var c="",d,e,f,g={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},h=window.document,i=h.createElement("div"),j=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,k={};a.each(g,function(a,e){if(i.style[a+"TransitionProperty"]!==b)return c="-"+l(a)+"-",d=e,!1}),k[c+"transition-property"]=k[c+"transition-duration"]=k[c+"transition-timing-function"]=k[c+"animation-name"]=k[c+"animation-duration"]="",a.fx={off:d===b&&i.style.transitionProperty===b,cssPrefix:c,transitionEnd:m("TransitionEnd"),animationEnd:m("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c/=1e3),this.anim(b,c,d,e)},a.fn.anim=function(d,e,f,g){var h,i={},l,m=this,n,o=a.fx.transitionEnd;e===b&&(e=.4),a.fx.off&&(e=0);if(typeof d=="string")i[c+"animation-name"]=d,i[c+"animation-duration"]=e+"s",o=a.fx.animationEnd;else{for(l in d)j.test(l)?(h||(h=[]),h.push(l+"("+d[l]+")")):i[l]=d[l];h&&(i[c+"transform"]=h.join(" ")),!a.fx.off&&typeof d=="object"&&(i[c+"transition-property"]=Object.keys(d).join(", "),i[c+"transition-duration"]=e+"s",i[c+"transition-timing-function"]=f||"linear")}return n=function(b){if(typeof b!="undefined"){if(b.target!==b.currentTarget)return;a(b.target).unbind(o,arguments.callee)}a(this).css(k),g&&g.call(this)},e>0&&this.bind(o,n),setTimeout(function(){m.css(i),e<=0&&setTimeout(function(){m.each(function(){n.call(this)})},0)},0),this},i=null}(Zepto),function($){function triggerAndReturn(a,b,c){var d=$.Event(b);return $(a).trigger(d,c),!d.defaultPrevented}function triggerGlobal(a,b,c,d){if(a.global)return triggerAndReturn(b||document,c,d)}function ajaxStart(a){a.global&&$.active++===0&&triggerGlobal(a,null,"ajaxStart")}function ajaxStop(a){a.global&&!--$.active&&triggerGlobal(a,null,"ajaxStop")}function ajaxBeforeSend(a,b){var c=b.context;if(b.beforeSend.call(c,a,b)===!1||triggerGlobal(b,c,"ajaxBeforeSend",[a,b])===!1)return!1;triggerGlobal(b,c,"ajaxSend",[a,b])}function ajaxSuccess(a,b,c){var d=c.context,e="success";c.success.call(d,a,e,b),triggerGlobal(c,d,"ajaxSuccess",[b,c,a]),ajaxComplete(e,b,c)}function ajaxError(a,b,c,d){var e=d.context;d.error.call(e,c,b,a),triggerGlobal(d,e,"ajaxError",[c,d,a]),ajaxComplete(b,c,d)}function ajaxComplete(a,b,c){var d=c.context;c.complete.call(d,b,a),triggerGlobal(c,d,"ajaxComplete",[b,c]),ajaxStop(c)}function empty(){}function mimeToDataType(a){return a&&(a==htmlType?"html":a==jsonType?"json":scriptTypeRE.test(a)?"script":xmlTypeRE.test(a)&&"xml")||"text"}function appendQuery(a,b){return(a+"&"+b).replace(/[&?]{1,2}/,"?")}function serializeData(a){isObject(a.data)&&(a.data=$.param(a.data)),a.data&&(!a.type||a.type.toUpperCase()=="GET")&&(a.url=appendQuery(a.url,a.data))}function serialize(a,b,c,d){var e=$.isArray(b);$.each(b,function(b,f){d&&(b=c?d:d+"["+(e?"":b)+"]"),!d&&e?a.add(f.name,f.value):(c?$.isArray(f):isObject(f))?serialize(a,f,c,b):a.add(b,f)})}var jsonpID=0,isObject=$.isObject,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(a){var b="jsonp"+ ++jsonpID,c=document.createElement("script"),d=function(){$(c).remove(),b in window&&(window[b]=empty),ajaxComplete("abort",e,a)},e={abort:d},f;return a.error&&(c.onerror=function(){e.abort(),a.error()}),window[b]=function(d){clearTimeout(f),$(c).remove(),delete window[b],ajaxSuccess(d,e,a)},serializeData(a),c.src=a.url.replace(/=\?/,"="+b),$("head").append(c),a.timeout>0&&(f=setTimeout(function(){e.abort(),ajaxComplete("timeout",e,a)},a.timeout)),e},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host);var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);settings.url||(settings.url=window.location.toString()),serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=$.ajaxSettings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:JSON.parse(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,"error",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(a,b){return $.ajax({url:a,success:b})},$.post=function(a,b,c,d){return $.isFunction(b)&&(d=d||c,c=b,b=null),$.ajax({type:"POST",url:a,data:b,success:c,dataType:d})},$.getJSON=function(a,b){return $.ajax({url:a,success:b,dataType:"json"})},$.fn.load=function(a,b){if(!this.length)return this;var c=this,d=a.split(/\s/),e;return d.length>1&&(a=d[0],e=d[1]),$.get(a,function(a){c.html(e?$(document.createElement("div")).html(a.replace(rscript,"")).find(e).html():a),b&&b.call(c)}),this};var escape=encodeURIComponent;$.param=function(a,b){var c=[];return c.add=function(a,b){this.push(escape(a)+"="+escape(b))},serialize(c,a,b),c.join("&").replace("%20","+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&d!="submit"&&d!="reset"&&d!="button"&&(d!="radio"&&d!="checkbox"||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a){function d(a){return"tagName"in a?a:a.parentNode}function e(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"}function h(){g=null,b.last&&(b.el.trigger("longTap"),b={})}function i(){g&&clearTimeout(g),g=null}var b={},c,f=750,g;a(document).ready(function(){var j,k;a(document.body).bind("touchstart",function(e){j=Date.now(),k=j-(b.last||j),b.el=a(d(e.touches[0].target)),c&&clearTimeout(c),b.x1=e.touches[0].pageX,b.y1=e.touches[0].pageY,k>0&&k<=250&&(b.isDoubleTap=!0),b.last=j,g=setTimeout(h,f)}).bind("touchmove",function(a){i(),b.x2=a.touches[0].pageX,b.y2=a.touches[0].pageY}).bind("touchend",function(a){i(),b.isDoubleTap?(b.el.trigger("doubleTap"),b={}):b.x2&&Math.abs(b.x1-b.x2)>30||b.y2&&Math.abs(b.y1-b.y2)>30?(b.el.trigger("swipe")&&b.el.trigger("swipe"+e(b.x1,b.x2,b.y1,b.y2)),b={}):"last"in b&&(b.el.trigger("tap"),c=setTimeout(function(){c=null,b.el.trigger("singleTap"),b={}},250))}).bind("touchcancel",function(){c&&clearTimeout(c),g&&clearTimeout(g),g=c=null,b={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto),define("libs/zepto",function(){}),define("jquery",["libs/zepto"],function(){return require(["libs/zepto"]),this.Zepto}),function(){function A(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&w.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return!1;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&A(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(w.has(a,h)){f++;if(!(g=w.has(b,h)&&A(a[h],b[h],c)))break}if(g){for(h in b)if(w.has(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new E(a)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=w),exports._=w):a._=w,w.VERSION="1.3.1";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(w.has(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=w.collect=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=w.toArray(a).reverse();return d&&!e&&(b=w.bind(b,d)),e?w.reduce(f,b,c,d):w.reduce(f,b)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},w.filter=w.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return a==null?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return a==null?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),e)};var y=w.some=w.any=function(a,b,d){b||(b=w.identity);var e=!1;return a==null?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};w.include=w.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(c=y(a,function(a){return a===b}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(w.isFunction(b)?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a))return Math.max.apply(Math,a);if(!b&&w.isEmpty(a))return-Infinity;var d={computed:-Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a))return Math.min.apply(Math,a);if(!b&&w.isEmpty(a))return Infinity;var d={computed:Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.shuffle=function(a){var b=[],c;return x(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},w.sortBy=function(a,b,c){return w.pluck(w.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={},d=w.isFunction(b)?b:function(a){return a[b]};return x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?a.toArray?a.toArray():w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):w.values(a):[]},w.size=function(a){return w.toArray(a).length},w.first=w.head=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},w.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a,b){return w.reduce(a,function(a,c){return w.isArray(c)?a.concat(b?c:w.flatten(c)):(a[a.length]=c,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b,c){var d=c?w.map(a,c):a,e=[];return w.reduce(d,function(c,d,f){if(0==f||(b===!0?w.last(c)!=d:!w.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a){var b=w.flatten(g.call(arguments,1));return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(c in a&&a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var z=function(){};w.bind=function(b,c){var d,e;if(b.bind===v&&v)return v.apply(b,g.call(arguments,1));if(!w.isFunction(b))throw new TypeError;return e=g.call(arguments,2),d=function(){if(this instanceof d){z.prototype=b.prototype;var a=new z,f=b.apply(a,e.concat(g.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return w.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))},w.throttle=function(a,b){var c,d,e,f,g,h=w.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},w.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},w.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments,0));return b.apply(this,c)}},w.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)w.has(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},w.clone=function(a){return w.isObject(a)?w.isArray(a)?a.slice():w.extend({},a):a},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){return A(a,b,[])},w.isEmpty=function(a){if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(w.has(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)=="[object Array]"},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return i.call(a)=="[object Arguments]"},w.isArguments(arguments)||(w.isArguments=function(a){return!!a&&!!w.has(a,"callee")}),w.isFunction=function(a){return i.call(a)=="[object Function]"},w.isString=function(a){return i.call(a)=="[object String]"},w.isNumber=function(a){return i.call(a)=="[object Number]"},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},w.isDate=function(a){return i.call(a)=="[object Date]"},w.isRegExp=function(a){return i.call(a)=="[object RegExp]"},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.has=function(a,b){return j.call(a,b)},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.mixin=function(a){x(w.functions(a),function(b){G(b,w[b]=a[b])})};var B=0;w.uniqueId=function(a){var b=B++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,D=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};w.template=function(a,b){var c=w.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape||C,function(a,b){return"',_.escape("+D(b)+"),'"}).replace(c.interpolate||C,function(a,b){return"',"+D(b)+",'"}).replace(c.evaluate||C,function(a,b){return"');"+D(b).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,w):function(a){return e.call(this,a,w)}},w.chain=function(a){return w(a).chain()};var E=function(a){this._wrapped=a};w.prototype=E.prototype;var F=function(a,b){return b?w(a).chain():a},G=function(a,b){E.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),F(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];E.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],F(c,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return F(b.apply(this._wrapped,arguments),this._chain)}}),E.prototype.chain=function(){return this._chain=!0,this},E.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return w})}.call(this),function(a,b){typeof exports!="undefined"?b(a,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)}):a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender)}(this,function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice,g=Array.prototype.splice;b.VERSION="0.9.2",b.setDomLibrary=function(a){d=a},b.noConflict=function(){return a.Backbone=e,b},b.emulateHTTP=!1,b.emulateJSON=!1;var h=/\s+/,i=b.Events={on:function(a,b,c){var d,e,f,g,i;if(!b)return this;a=a.split(h),d=this._callbacks||(this._callbacks={});while(e=a.shift())i=d[e],f=i?i.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:i?i.next:f};return this},off:function(a,b,d){var e,f,g,i,j,k;if(!(f=this._callbacks))return;if(!(a||b||d))return delete this._callbacks,this;a=a?a.split(h):c.keys(f);while(e=a.shift()){g=f[e],delete f[e];if(!g||!b&&!d)continue;i=g.tail;while((g=g.next)!==i)j=g.callback,k=g.context,(b&&j!==b||d&&k!==d)&&this.on(e,j,k)}return this},trigger:function(a){var b,c,d,e,g,i,j;if(!(d=this._callbacks))return this;i=d.all,a=a.split(h),j=f.call(arguments,1);while(b=a.shift()){if(c=d[b]){e=c.tail;while((c=c.next)!==e)c.callback.apply(c.context||this,j)}if(c=i){e=c.tail,g=[b].concat(j);while((c=c.next)!==e)c.callback.apply(c.context||this,g)}}return this}};i.bind=i.on,i.unbind=i.off;var j=b.Model=function(a,b){var d;a||(a={}),b&&b.parse&&(a=this.parse(a));if(d=A(this,"defaults"))a=c.extend({},d,a);b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=c.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=c.clone(this.attributes),this.initialize.apply(this,arguments)};c.extend(j.prototype,i,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var d=this.get(a);return this._escapedAttributes[a]=c.escape(d==null?"":""+d)},has:function(a){return this.get(a)!=null},set:function(a,b,d){var e,f,g;c.isObject(a)||a==null?(e=a,d=b):(e={},e[a]=b),d||(d={});if(!e)return this;e instanceof j&&(e=e.attributes);if(d.unset)for(f in e)e[f]=void 0;if(!this._validate(e,d))return!1;this.idAttribute in e&&(this.id=e[this.idAttribute]);var h=d.changes={},i=this.attributes,k=this._escapedAttributes,l=this._previousAttributes||{};for(f in e){g=e[f];if(!c.isEqual(i[f],g)||d.unset&&c.has(i,f))delete k[f],(d.silent?this._silent:h)[f]=!0;d.unset?delete i[f]:i[f]=g,!c.isEqual(l[f],g)||c.has(i,f)!=c.has(l,f)?(this.changed[f]=g,d.silent||(this._pending[f]=!0)):(delete this.changed[f],delete this._pending[f])}return d.silent||this.change(d),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(c.clone(this.attributes),a)},fetch:function(a){a=a?c.clone(a):{};var d=this,e=a.success;return a.success=function(b,c,f){if(!d.set(d.parse(b,f),a))return!1;e&&e(d,b)},a.error=b.wrapError(a.error,d,a),(this.sync||b.sync).call(this,"read",this,a)},save:function(a,d,e){var f,g;c.isObject(a)||a==null?(f=a,e=d):(f={},f[a]=d),e=e?c.clone(e):{};if(e.wait){if(!this._validate(f,e))return!1;g=c.clone(this.attributes)}var h=c.extend({},e,{silent:!0});if(f&&!this.set(f,e.wait?h:e))return!1;var i=this,j=e.success;e.success=function(a,b,d){var g=i.parse(a,d);e.wait&&(delete e.wait,g=c.extend(f||{},g));if(!i.set(g,e))return!1;j?j(i,a):i.trigger("sync",i,a,e)},e.error=b.wrapError(e.error,i,e);var k=this.isNew()?"create":"update",l=(this.sync||b.sync).call(this,k,this,e);return e.wait&&this.set(g,h),l},destroy:function(a){a=a?c.clone(a):{};var d=this,e=a.success,f=function(){d.trigger("destroy",d,d.collection,a)};if(this.isNew())return f(),!1;a.success=function(b){a.wait&&f(),e?e(d,b):d.trigger("sync",d,b,a)},a.error=b.wrapError(a.error,d,a);var g=(this.sync||b.sync).call(this,"delete",this,a);return a.wait||f(),g},url:function(){var a=A(this,"urlRoot")||A(this.collection,"url")||B();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var d in this._silent)this._pending[d]=!0;var e=c.extend({},a.changes,this._silent);this._silent={};for(var d in e)this.trigger("change:"+d,this,this.get(d),a);if(b)return this;while(!c.isEmpty(this._pending)){this._pending={},this.trigger("change",this,a);for(var d in this.changed){if(this._pending[d]||this._silent[d])continue;delete this.changed[d]}this._previousAttributes=c.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return arguments.length?c.has(this.changed,a):!c.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._previousAttributes;for(var f in a){if(c.isEqual(e[f],b=a[f]))continue;(d||(d={}))[f]=b}return d},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return c.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validate(a,b);return d?(b&&b.error?b.error(this,d,b):this.trigger("error",this,d,b),!1):!0}});var k=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})};c.extend(k.prototype,i,{model:j,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var d,e,f,h,i,j,k={},l={},m=[];b||(b={}),a=c.isArray(a)?a.slice():[a];for(d=0,f=a.length;d<f;d++){if(!(h=a[d]=this._prepareModel(a[d],b)))throw new Error("Can't add an invalid model to a collection");i=h.cid,j=h.id;if(k[i]||this._byCid[i]||j!=null&&(l[j]||this._byId[j])){m.push(d);continue}k[i]=l[j]=h}d=m.length;while(d--)a.splice(m[d],1);for(d=0,f=a.length;d<f;d++)(h=a[d]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,h.id!=null&&(this._byId[h.id]=h);this.length+=f,e=b.at!=null?b.at:this.models.length,g.apply(this.models,[e,0].concat(a)),this.comparator&&this.sort({silent:!0});if(b.silent)return this;for(d=0,f=this.models.length;d<f;d++){if(!k[(h=this.models[d]).cid])continue;b.index=d,h.trigger("add",h,this,b)}return this},remove:function(a,b){var d,e,f,g;b||(b={}),a=c.isArray(a)?a.slice():[a];for(d=0,e=a.length;d<e;d++){g=this.getByCid(a[d])||this.get(a[d]);if(!g)continue;delete this._byId[g.id],delete this._byCid[g.cid],f=this.indexOf(g),this.models.splice(f,1),this.length--,b.silent||(b.index=f,g.trigger("remove",g,this,b)),this._removeReference(g)}return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,b),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,c.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},get:function(a){return a==null?void 0:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return c.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=c.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return c.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});for(var d=0,e=this.models.length;d<e;d++)this._removeReference(this.models[d]);return this._reset(),this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a=a?c.clone(a):{},a.parse===undefined&&(a.parse=!0);var d=this,e=a.success;return a.success=function(b,c,f){d[a.add?"add":"reset"](d.parse(b,f),a),e&&e(d,b)},a.error=b.wrapError(a.error,d,a),(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var d=this;b=b?c.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||d.add(a,b);var e=b.success;return b.success=function(c,f,g){b.wait&&d.add(c,b),e?e(c,f):c.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return c(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){b||(b={});if(a instanceof j)a.collection||(a.collection=this);else{var c=a;b.collection=this,a=new this.model(c,b),a._validate(a.attributes,b)||(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(a!="add"&&a!="remove"||c==this)a=="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments);else return}});var l=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];c.each(l,function(a){k.prototype[a]=function(){return c[a].apply(c,[this.models].concat(c.toArray(arguments)))}});var m=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},n=/:\w+/g,o=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;c.extend(m.prototype,i,{initialize:function(){},route:function(a,d,e){return b.history||(b.history=new q),c.isRegExp(a)||(a=this._routeToRegExp(a)),e||(e=this[d]),b.history.route(a,c.bind(function(c){var f=this._extractParameters(a,c);e&&e.apply(this,f),this.trigger.apply(this,["route:"+d].concat(f)),b.history.trigger("route",this,d,f)},this)),this},navigate:function(a,c){b.history.navigate(a,c)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(p,"\\$&").replace(n,"([^/]+)").replace(o,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var q=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl")},r=/^[#\/]/,s=/msie [\w.]+/;q.started=!1,c.extend(q.prototype,i,{interval:50,getHash:function(a){var b=a?a.location:window.location,c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(r,"")},start:function(a){if(q.started)throw new Error("Backbone.history has already been started");q.started=!0,this.options=c.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),e=document.documentMode,f=s.exec(navigator.userAgent.toLowerCase())&&(!e||e<=7);f&&(this.iframe=d('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?d(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?d(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var g=window.location,h=g.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&g.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){d(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe)));if(b==this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a),d=c.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return d},navigate:function(a,b){if(!q.started)return!1;if(!b||b===!0)b={trigger:b};var c=(a||"").replace(r,"");if(this.fragment==c)return;this._hasPushState?(c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var t=b.View=function(a){this.cid=c.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];c.extend(t.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var e=document.createElement(a);return b&&d(e).attr(b),c!=null&&d(e).html(c),e},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof d?a:d(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=A(this,"events")))return;this.undelegateEvents();for(var b in a){var d=a[b];c.isFunction(d)||(d=this[a[b]]);if(!d)throw new Error('Method "'+a[b]+'" does not exist');var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,g===""?this.$el.bind(f,d):this.$el.delegate(g,f,d)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=c.extend({},this.options,a));for(var b=0,d=v.length;b<d;b++){var e=v[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(!this.el){var a=A(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}else this.setElement(this.el,!1)}});var w=function(a,b){var c=z(this,a,b);return c.extend=this.extend,c};j.extend=k.extend=m.extend=t.extend=w;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,e,f){var g=x[a];f||(f={});var h={type:g,dataType:"json"};return f.url||(h.url=A(e,"url")||B()),!f.data&&e&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(e.toJSON())),b.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),b.emulateHTTP&&(g==="PUT"||g==="DELETE")&&(b.emulateJSON&&(h.data._method=g),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)}),h.type!=="GET"&&!b.emulateJSON&&(h.processData=!1),d.ajax(c.extend(h,f))},b.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(b,e,c):b.trigger("error",b,e,c)}};var y=function(){},z=function(a,b,d){var e;return b&&b.hasOwnProperty("constructor")?e=b.constructor:e=function(){a.apply(this,arguments)},c.extend(e,a),y.prototype=a.prototype,e.prototype=new y,b&&c.extend(e.prototype,b),d&&c.extend(e,d),e.prototype.constructor=e,e.__super__=a.prototype,e},A=function(a,b){return!a||!a[b]?null:c.isFunction(a[b])?a[b]():a[b]},B=function(){throw new Error('A "url" property or function must be specified')};return b}),define("ich",["jquery"],function(a){function c(){var c=this;c.VERSION="0.9",c.templates={},c.partials={},c.addTemplate=function(d,e){c.templates[d]=e,c[d]=function(e,f){e=e||{};var g=b.to_html(c.templates[d],e,c.partials);return f?g:a(g)}},c.addPartial=function(a,b){c.partials[a]=b},c.grabTemplates=function(){a('script[type="text/html"]').each(function(b,d){var e=a(typeof b=="number"?d:b),f="".trim?e.html().trim():a.trim(e.html());c[e.hasClass("partial")?"addPartial":"addTemplate"](e.attr("id"),f),e.remove()})},c.clearAll=function(){for(var a in c.templates)delete c[a];c.templates={},c.partials={}},c.refresh=function(){c.clearAll(),c.grabTemplates()}}var b=function(){var a=function(){};return a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a);return}a=this.render_pragmas(a);var e=this.render_section(a,b,c);if(d)return this.render_tags(e,b,c,d);this.render_tags(e,b,c,d)},send:function(a){a!=""&&this.buffer.push(a)},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this,c=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag);return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return typeof b[a]!="object"?this.render(c[a],b,c,!0):this.render(c[a],b[a],c,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return a;var d=this,e=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return a.replace(e,function(a,e,f,g){var h=d.find(f,b);if(e=="^")return!h||d.is_array(h)&&h.length===0?d.render(g,b,c,!0):"";if(e=="#")return d.is_array(h)?d.map(h,function(a){return d.render(g,d.create_context(a),c,!0)}).join(""):d.is_object(h)?d.render(g,d.create_context(h),c,!0):typeof h=="function"?h.call(b,g,function(a){return d.render(a,b,c,!0)}):h?d.render(g,b,c,!0):""})},render_tags:function(a,b,c,d){var e=this,f=function(){return new RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},g=f(),h=function(a,d,h){switch(d){case"!":return"";case"=":return e.set_delimiters(h),g=f(),"";case">":return e.render_partial(h,b,c);case"{":return e.find(h,b);default:return e.escape(e.find(h,b))}},i=a.split("\n");for(var j=0;j<i.length;j++)i[j]=i[j].replace(g,h,this),d||this.send(i[j]);if(d)return i.join("\n")},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]),this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function c(a){return a===!1||a===0||a}a=this.trim(a);var d;return c(b[a])?d=b[a]:c(this.context[a])&&(d=this.context[a]),typeof d=="function"?d.apply(b):d!==undefined?d:""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return a=String(a===null?"":a),a.replace(/&(?!\w+;)|["<>\\]/g,function(a){switch(a){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'"';case"<":return"&lt;";case">":return"&gt;";default:return a}})},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);var c=[],d=a.length;for(var e=0;e<d;e++)c.push(b(a[e]));return c}},{name:"mustache.js",version:"0.3.0",to_html:function(b,c,d,e){var f=new a;e&&(f.send=e),f.render(b,c,d);if(!e)return f.buffer.join("\n")}}}();return new c}),define("ivle",["jquery","underscore"],function(a,b){var c=function(a){var b="https://ivle.nus.edu.sg/api/Lapi.svc/",c=function(b,c,d,e,f){a.ajax({type:"GET",dataType:"jsonp",data:c,contentType:"application/x-javascript",url:b,xhrFields:{withCredentials:!1},success:d,error:function(g,h,i){var j=b+"?"+decodeURIComponent(a.param(c));f?a.ajax({type:"POST",dataType:"json",data:{request:j},url:f,dataFilter:function(b){return a.parseJSON(b)},success:d,error:e}):e&&e.apply(this,arguments)}})},d=function(a,d){this.auth=function(b,c){b.click(function(){var b="https://ivle.nus.edu.sg/api/login/?apikey="+a+"&url="+encodeURIComponent(c);window.location.href=b})},this.user=function(e){this.authtoken=e,this.setauthtoken=function(a){this.authtoken=a},this.validate=function(e,f){var g="Validate",h={APIKey:a,Token:this.authtoken,output:"json"},i=b+g;c(i,h,e,f,d)},this.uid=function(e,f){var g="UserID_Get",h={APIKey:a,Token:this.authtoken,output:"json"},i=b+g;c(i,h,e,f,d)},this.uname=function(e,f){var g="UserName_Get",h={APIKey:a,Token:this.authtoken,output:"json"},i=b+g;c(i,h,e,f,d)},this.email=function(e,f){var g="UserEmail_Get",h={APIKey:a,Token:this.authtoken,output:"json"},i=b+g;c(i,h,e,f,d)},this.modules=function(e,f){var g="Modules",h={APIKey:a,AuthToken:this.authtoken,Duration:0,IncludeAllInfo:!1,output:"json"},i=b+g;c(i,h,e,f,d)},this.workbin=function(e,f,g){var h="Workbins",i={APIKey:a,AuthToken:this.authtoken,CourseId:e,Duration:0,TitleOnly:!1,output:"json"},j=b+h;c(j,i,f,g,d)},this.file=function(b){var c="https://ivle.nus.edu.sg/api/downloadfile.ashx?APIKey="+a+"&AuthToken="+this.authtoken+"&ID="+b+"&target=workbin";window.location.href=c},this.announcements=function(e,f,g){var h="Announcements",i={APIKey:a,AuthToken:this.authtoken,CourseId:e,Duration:0,TitleOnly:!1,output:"json"},j=b+h;c(j,i,f,g,d)},this.forums=function(e,f,g){var h="Forums",i={APIKey:a,AuthToken:this.authtoken,CourseId:e,Duration:0,IncludeThreads:!1,TitleOnly:!1,output:"json"},j=b+h;c(j,i,f,g,d)},this.forumheadingthreads=function(e,f,g){var h="Forum_HeadingThreads",i={APIKey:a,AuthToken:this.authtoken,HeadingID:e,Duration:0,GetMainTopicsOnly:!0,output:"json"},j=b+h;c(j,i,f,g,d)},this.forumthread=function(e,f,g){var h="Forum_Threads",i={APIKey:a,AuthToken:this.authtoken,GetSubThreads:!0,Duration:0,ThreadID:e,output:"json"},j=b+h;c(j,i,f,g,d)}}};return d}(a);return c}),define("models",["jquery","underscore","backbone"],function(a,b,c){var d={},e={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};return d.readabledate=function(a){var b=Date.now()-a.getTime(),c=Math.round(Math.abs(b)/1e3),d=Math.round(c/60),e=Math.round(d/60),f=Math.round(e/24),g=Math.round(f/365),h=c<45&&"a few seconds"||d===1&&"a minute"||d<45&&d+" minutes"||e===1&&"an hour"||e<22&&e+" hours"||f===1&&"a day"||f<=25&&f+" days"||f<=45&&"a month"||f<345&&Math.round(f/30)+" months"||g===1&&"a year"||g+" years";return h+" ago"},d.nicedate=function(a){var b=a.match(/(\d+)/g),c=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);return c},d.Items=c.Collection.extend({}),d.Folder=c.Model.extend({initialize:function(a,b){this.parent=b,this.set({path:this.get("name")});var c=this.get("count");this.get("folders")&&(c=parseInt(c,10)+this.get("folders").length),c===0?this.set({size:"empty"}):this.set({size:c+" items"}),this.init()},init:function(){var a=b.map(this.get("files"),function(a){return new d.File(a,this)},this),c=b.map(this.get("folders"),function(a){return new d.Folder(a,this)},this);this.items=new d.Items,this.items.add(c),this.items.add(a)},getlatest:function(){var a=this.toJSON();return a.files=[],a.folders=[],b.each(this.items.models,function(b){b.get("type")==="document"?a.files.push(b.toJSON()):b.get("type")==="folder"&&a.folders.push(b.getlatest())}),a},filepath:function(){var a="",b=this.parent;while(b)a=b.get("name")+"/"+a,b=b.parent;return a+b.get("name")},hasnewfiles:function(){var a=b.filter(this.items.models,function(a){if(a.get("type")==="document")return a.isnotdled();if(a.get("type")==="folder")return a.hasnewfiles()},this);return a.length}}),d.File=c.Model.extend({initialize:function(a,b){this.parent=b,this.set({size:this.calcfilesize(this.get("bytes"))}),this.set({kind:this.get("filetype")+" document"})},calcfilesize:function(a){var b,c;b=["bytes","KB","MB","GB"],c=0;while(Math.floor(a).toString().length>3)c++,a=parseInt(a,10),a/=1024;return Math.round(a)!==a&&(a=parseFloat(a,10).toFixed(2).toString().slice(0,6)),a+" "+b[c]},dled:function(){this.set({dled:"true"});var a=this.parent;while(a.parent)a=a.parent;a.updateserver()},isnotdled:function(){return!this.get("dled")||this.get("dled")==="false"}}),d.Workbin=c.Model.extend({initialize:function(){this.type="workbin",this.fields(),this.on("change",this.fields,this),b.bindAll(this,"updateserver")},fields:function(){var a=b.map(this.get("folders"),function(a){return new d.Folder(a,this)},this);this.items=new d.Items(a)},setname:function(a){this.set({name:a})},filepath:function(){return this.get("name")},updateserver:function(){var c=this.toJSON();c.folders=b.map(this.items.models,function(a){return a.getlatest()}),a.ajax({type:"POST",url:"/workbin",data:{moduleid:this.get("modid"),workbin:JSON.stringify(c)},success:function(a){},dataType:"json"})}}),d.Announcement=c.Model.extend({initialize:function(a){this.set({path:this.id}),this.get("date")&&this.set({nicedate:d.readabledate(this.get("date"))})}}),d.Announcements=c.Collection.extend({initialize:function(a){this.loaded=!1},model:d.Announcement,isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),d.Thread=c.Model.extend({initialize:function(a,c){b.bindAll(this,"setthreads","fetch","thinthread"),this.set({path:this.id}),this.parent=c.parent,this.user=c.user,this.type="thread",this.threads=[],this.get("threads")&&this.setthreads(this.get("threads"));var e=this.get("date");typeof e=="string"&&(e=d.nicedate(e)),this.set({nicedate:d.readabledate(e)}),this.loaded=!1},isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0},fetch:function(){var a=this;this.user.forumthread(this.id,function(b){var c=b.Results.length!==0?b.Results[0]:null;c=a.thinthread(c),a.setthreads(c.threads),a.isloaded(),a.trigger("reset")})},setthreads:function(a){a=b.map(a,function(a){var b=new d.Thread(a,{parent:this,user:this.user});return b},this),this.threads=a},thinthread:function(a){if(!a)return;return{id:a.ID,name:a.PostTitle,author:a.Poster.Name,email:a.Poster.Email,uid:a.Poster.UserID,body:a.PostBody,date:d.nicedate(a.PostDate_js),threads:b.map(a.Threads.reverse(),function(a){return this.thinthread(a)},this)}}}),d.Threads=c.Collection.extend({initialize:function(a){this.loaded=a.length===0?!1:!0},model:d.Thread,isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),d.Heading=c.Model.extend({initialize:function(a,c){this.type="heading",this.parent=c.parent,this.user=c.user;var e=[];this.get("threads")&&b.each(this.get("threads"),function(a){var b=new d.Thread(a,{parent:this,user:this.user});e.push(b)},this),this.threads=new d.Threads(e),this.set({path:this.get("name")})},update:function(){var a=this;this.user.forumheadingthreads(this.id,function(c){var e=b.map(c.Results,function(a){return{id:a.ID,name:a.PostTitle,author:a.Poster.Name,email:a.Poster.Email,uid:a.Poster.UserID,body:a.PostBody,date:d.nicedate(a.PostDate_js)}});b.each(e,function(b){var c=new d.Thread(b,{parent:this,user:a.user});a.threads.add(c,{silent:!0})},a),a.threads.isloaded(),a.threads.trigger("reset"),a.updateserver()})},updateserver:function(){a.ajax({type:"POST",url:"/forum/heading",data:{moduleid:this.parent.get("modid"),headingid:this.id,threads:JSON.stringify(this.threads.toJSON())},success:function(a){},dataType:"json"})}}),d.Headings=c.Collection.extend({initialize:function(a){this.loaded=a.length===0?!1:!0},model:d.Heading,isloading:function(){return!this.loaded},isloaded:function(){this.loaded=!0}}),d.Forum=c.Model.extend({initialize:function(a,c){this.type="forum",this.user=c.user;var e=[];this.get("headings")&&b.each(this.get("headings"),function(a){var b=new d.Heading(a,{parent:this,user:this.user});e.push(b)},this),this.headings=new d.Headings(e),b.bindAll(this,"update")},update:function(a){this.set(a),b.each(a.headings,function(a){var b=new d.Heading(a,{parent:this,user:this.user});this.headings.add(b,{silent:!0})},this),this.headings.isloaded(),this.headings.trigger("reset")},updateserver:function(){a.ajax({type:"POST",url:"/forum",data:{moduleid:this.get("modid"),forum:JSON.stringify(this.toJSON())},success:function(a){},dataType:"json"})}}),d.Module=c.Model.extend({initialize:function(a,c){this.user=c.user,this.workbin=new d.Workbin(this.get("workbin")),this.workbin.setname(this.get("code")),this.announcements=new d.Announcements(this.get("announcements")),this.forum=new d.Forum(this.get("forum"),{user:this.user}),b.bindAll(this,"fetchworkbin","thinfolder","fetchannouncements")},defaults:{id:""},thinfiles:function(a){return b.map(a.reverse(),function(a){var b={};return b.desc=a.FileDescription,b.name=a.FileName,b.bytes=a.FileSize,b.filetype=a.FileType,b.id=a.ID,b.type="document",b.dled=a.isDownloaded?!0:!1,b})},thinfolder:function(a){return b.map(a,function(a){var b={};return b.name=a.FolderName,b.count=a.FileCount,b.files=this.thinfiles(a.Files),b.folders=this.thinfolder(a.Folders),b.id=a.ID,b.type=b.kind="folder",b},this)},thinheadings:function(a){return b.map(a,function(a){return{id:a.ID,name:a.Title,order:a.HeadingOrder}})},fetchworkbin:function(){var a=this;return this.user.workbin(this.id,function(b){b.Results.length===0&&(b.Results[0]={});var c={};c.folders=a.thinfolder(b.Results[0].Folders),c.modid=a.id,c.id=b.Results[0].ID||-1,c.type=c.kind="folder",c.title=b.Results[0].Title,a.workbin.set(c),a.workbin.updateserver()}),this},fetchannouncements:function(){var a=this;return this.user.announcements(this.id,function(c){var e=b.map(c.Results,function(a){var b={};return b.id=a.ID,b.title=a.Title,b.date=d.nicedate(a.CreatedDate_js),b.contents=a.Description,b.from=a.Creator.Name,b},a);a.announcements.isloaded(),a.announcements.add(e,{silent:!0}),a.announcements.trigger("change")}),this},fetchforums:function(){var a=this;return this.user.forums(this.id,function(b){var c=b.Results.length>0?b.Results[0]:{},d={id:c.ID,modid:a.id,title:c.Title,headings:a.thinheadings(c.Headings)};a.forum.update(d),a.forum.updateserver()}),this}}),d.Modules=c.Collection.extend({initialize:function(a,c){this.user=c.user,b.bindAll(this,"fetch")},model:d.Module,fetch:function(c){var e=this;this.user.modules(function(f){var g=function(a){return b.find(f.Results,function(b){return a.id===b.ID})};b.each(e.models,function(a){g(a)||this.remove(a)},e);var h=b.map(f.Results,function(a){var b={};return b.code=a.CourseCode,b.name=a.CourseName,b.sem=a.CourseSemester,b.year=a.CourseAcadYear,b.id=a.ID,b});b.each(h,function(a){var b=this.get(a.id);if(b)b.set(a,{silent:!0});else{var c=new d.Module(a,{user:this.user});this.add(c,{silent:!0})}},e),e.trigger("reset"),c&&c(),a.ajax({type:"POST",url:"/modules",data:{modules:JSON.stringify(h)},success:function(a){},dataType:"json"})})}}),d}),define("views",["jquery","underscore","backbone","ich"],function(a,b,c,d){var e={};return e.MainView=c.View.extend({el:"#main_container",initialize:function(a){this.user=a.user,this.modules=a.modules,b.bindAll(this,"render","moduleselected")},render:function(){return this.modulesview=(new e.ModulesView({collection:this.modules})).render(),this.contentview=(new e.ContentView({user:this.user})).render(),this},events:{moduleselected:"moduleselected"},moduleselected:function(a,b){this.modulesview.active(b.get("code")),this.contentview.changemodule(b);if(a){var c=this.contentview.currentview;this.$el.trigger("navigateto",[b.get("code"),c])}}}),e.ModulesView=c.View.extend({el:"#leftbar",initialize:function(){this.collection.on("reset",this.render,this)},render:function(){this.views=[];var a=document.createDocumentFragment();return b.each(this.collection.models,function(b){var c=new e.ModuleView({model:b});this.views.push(c),a.appendChild(c.render().el)},this),this.$el.html(a),this.activemod&&this.active(this.activemod),this},active:function(a){this.activemod=a,this.$(".active").removeClass("active"),b.each(this.views,function(b){b.model.get("code")===a&&b.active()},this)},highlight:function(a){this.$(".highlight").removeClass("highlight"),this.views[a].$el.addClass("highlight")}}),e.ModuleView=c.View.extend({className:"moduleview",initialize:function(){},render:function(){return this.$el.html(d.moduleview(this.model.toJSON())),this},events:{click:"moduleselected"},moduleselected:function(){this.$el.trigger("moduleselected",this.model)},active:function(){this.$el.addClass("active")}}),e.ContentView=c.View.extend({el:"#content",initialize:function(a){this.user=a.user,this.module=null,this.defaultview="announcements",this.currentview=this.defaultview,b.bindAll(this,"render","changemodule","changeview")},render:function(){return this.module!==null&&(this.$el.html(d.contentview()),this.contentnav=(new e.ContentNavView({view:this.defaultview})).render(),this.contentcontainer=(new e.ContentContainerView({user:this.user,module:this.module,view:this.defaultview})).render()),this},changemodule:function(a){this.module===null?(this.module=a,this.render()):(this.module=a,this.contentcontainer.changemodule(this.module))},changeview:function(a,b){this.currentview=b,this.contentcontainer.changeview(b),this.contentnav.changeview(b),a&&this.navigate()},navigate:function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(this.module.get("code"),this.currentview),this.$el.trigger("navigateto",b)},events:{changeview:"changeview",navigate:"navigate"}}),e.ContentNavView=c.View.extend({el:"#tabs",initialize:function(a){this.views=["announcements","workbin","forum"],this.children=[],this.currentview=a.view},render:function(){var a=document.createDocumentFragment();return b.each(this.views,function(b){var c=new e.ContentNavItemView({name:b});this.children.push(c),a.appendChild(c.render().el)},this),this.$el.html(a),this.changeview(this.currentview),this},changeview:function(a){b.each(this.children,function(b){b.name===a?b.active():b.inactive()},this)}}),e.ContentNavItemView=c.View.extend({tagName:"div",className:"tab",initialize:function(a){this.name=a.name},render:function(){return this.$el.html(this.name),this},events:{click:"changeview"},changeview:function(){this.$el.hasClass("active")||this.$el.trigger("changeview",this.name)},active:function(){this.$el.addClass("active")},inactive:function(){this.$el.removeClass("active")}}),e.ContentContainerView=c.View.extend({el:"#tabcontent",initialize:function(a){this.user=a.user,this.module=a.module,this.currentview=a.view,this.viewobj={}},render:function(){var a=this.view(this.currentview);return this.viewobj=new a({user:this.user,model:this.module}),this.$el.html(this.viewobj.render().el),this},view:function(a){if(a==="workbin")return e.WorkbinView;if(a==="announcements")return e.AnnouncementsView;if(a==="forum")return e.ForumView},changemodule:function(a){this.module=a,this.render()},changeview:function(a){this.currentview=a,this.render()}}),e.Breadcrumb=c.View.extend({className:"breadcrumb",initialize:function(a){this.type=a.type},render:function(){return this.model.type==="thread"?this:(this.model.parent?this.$el.html(d.breadcrumb(this.model.toJSON())):this.$el.html(d.breadcrumbicon({type:this.model.type})),this.$el.addClass(this.type),this)},events:{click:"drilldown"},drilldown:function(){this.type==="parent"&&this.$el.trigger("drilldown",this.model)}}),e.Breadcrumbs=c.View.extend({initialize:function(){},render:function(){var a=this.model.parent;if(!a)return this.$el.hide(),this;while(a){var b=new e.Breadcrumb({model:a,type:"parent"});this.$el.prepend(b.render().el),a=a.parent}var c=new e.Breadcrumb({model:this.model,type:"current"});return this.$el.append(c.render().el),this.$el.addClass("breadcrumbs"),this}}),e.ForumView=c.View.extend({id:"forumcontainer",initialize:function(a){this.user=a.user,this.currentitem=this.model.fetchforums().forum},render:function(){this.$el.html(d.forumview()),this.breadcrumbs=new e.Breadcrumbs({model:this.currentitem,el:this.$("#forumheader")}),this.breadcrumbs.render();if(this.currentitem.type==="forum")this.headingsview=new e.ForumHeadingsView({model:this.currentitem}),this.$("#forumcontents").html(this.headingsview.render().el);else if(this.currentitem.type==="heading"){var a=new e.ForumThreadsView({model:this.currentitem});this.$("#forumcontents").html(a.render().el)}else if(this.currentitem.type==="thread"){var b=new e.ForumSingleThreadView({model:this.currentitem});this.$(".tabcontents").html(b.render().el)}return this},events:{drilldown:"drilldown"},drilldown:function(a,b){this.currentitem=b,this.render();if(a){var c=[],d=this.currentitem;while(d.parent){var e=d.get("path");c.unshift(e),d=d.parent}this.$el.trigger("navigate",c)}}}),e.ForumHeadingsView=c.View.extend({initialize:function(){this.model.headings.on("reset",this.render,this)},render:function(){if(this.model.headings.isloading())this.$el.html(d.inforow({text:"loading..."}));else if(this.model.headings.models.length===0)this.$el.html(d.inforow({text:"no headings"}));else{var a=document.createDocumentFragment();b.each(this.model.headings.models,function(b){var c=new e.ForumItemView({model:b});a.appendChild(c.render().el)}),this.$el.html(a)}return this}}),e.ForumThreadsView=c.View.extend({initialize:function(){this.model.update(),this.model.threads.on("reset",this.render,this)},render:function(){if(this.model.threads.isloading())this.$el.html(d.inforow({text:"loading..."}));else if(this.model.threads.models.length===0)this.$el.html(d.inforow({text:"zero threads :("}));else{var a=document.createDocumentFragment();b.each(this.model.threads.models,function(b){var c=new e.ForumItemView({model:b});a.appendChild(c.render().el)}),this.$el.html(a)}return this}}),e.ForumItemView=c.View.extend({className:"tabrow itemview",initialize:function(){},render:function(){return this.model.type==="heading"?this.$el.html(d.forumheadingview(this.model.toJSON())):this.model.type==="thread"&&this.$el.html(d.forumthreadview(this.model.toJSON())),this},events:{click:"drilldown"},drilldown:function(){this.$el.trigger("drilldown",this.model)}}),e.ForumSingleThreadView=c.View.extend({id:"forumsinglethreadview",initialize:function(){this.model.fetch(),this.model.on("reset",this.render,this)},render:function(){var a;return this.model.isloading()?(a=new e.ForumSingleThreadThreadView({model:this.model,root:!0,loading:!0}),this.$el.html(a.render().el)):(a=new e.ForumSingleThreadThreadView({model:this.model,root:!0}),this.$el.html(a.render().el)),this}}),e.ForumSingleThreadThreadView=c.View.extend({className:"tabpost forumpost",initialize:function(a){this.root=a.root,this.loading=a.loading},render:function(){return this.$el.html(d.forumpost(this.model.toJSON())),this.loading?this.$el.append(d.inforow({text:"loading entire thread..."})):(this.model.threads.length!==0&&b.each(this.model.threads,function(a){var b=new e.ForumSingleThreadThreadView({model:a});this.$(".subthreads").append(b.render().el)},this),this.root&&this.$el.append(d.inforow({text:"end of thread."}))),this}}),e.AnnouncementsView=c.View.extend({className:"announcementsview",tagName:"div",initialize:function(a){this.user=a.user,this.announcements=this.model.fetchannouncements().announcements,this.announcements.on("change",this.render,this)},render:function(){if(this.announcements.isloading())this.$el.html(d.inforow({text:"loading..."}));else if(this.announcements.models.length===0)this.$el.html(d.inforow({text:"no announcements."}));else{var a=document.createDocumentFragment();b.each(this.announcements.models,function(b){var c=new e.AnnouncementView({model:b});a.appendChild(c.render().el)},this),this.$el.html(a),this.$(".announcementview:first-child").click()}return this}}),e.AnnouncementView=c.View.extend({tagName:"div",className:"announcementview tabpost",initialize:function(a){},render:function(){return this.$el.html(d.announcementview(this.model.toJSON())),this}}),e.WorkbinView=c.View.extend({initialize:function(a){this.user=a.user,this.currentitem=this.model.fetchworkbin().workbin,this.currentitem.on("all",this.render,this)},render:function(){this.$el.html(d.workbinview()),this.breadcrumbs=new e.Breadcrumbs({model:this.currentitem,el:this.$("#workbinheading")}),this.breadcrumbs.render();if(typeof this.currentitem.get("id")!="undefined")if(this.currentitem.items.models.length===0)this.$("#filescontainer").html(d.emptyfolder());else{var a=document.createDocumentFragment();this.elems=[],b.each(this.currentitem.items.models,function(b){var c;b.get("type")==="document"?c=new e.FileView({model:b}):b.get("type")==="folder"&&(c=new e.FolderView({model:b})),this.elems.push(c),a.appendChild(c.render().el)},this),this.$("#filescontainer").html(a)}else this.$("#filescontainer").html(d.loadingfolder());return this},events:{drilldown:"drilldown",downloadfile:"downloadfile"},drilldown:function(a,b){this.currentitem=b,this.render();if(a){var c=[],d=this.currentitem;while(d.parent){var e=d.get("path");c.unshift(e),d=d.parent}this.$el.trigger("navigate",c)}},downloadfile:function(a,b){this.user.file(b.id),setTimeout(function(){b.isnotdled()&&b.dled()},500)},highlight:function(a){this.$(".highlight").removeClass("highlight"),this.elems[a].$el.addClass("highlight")}}),e.FileView=c.View.extend({className:"tabrow itemview fileview",initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.$el.html(d.itemview(this.model.toJSON())),this.itemicon(),this.model.isnotdled()&&this.$(".rowicon").append("<div class='notification'>1</div>"),this},itemicon:function(){var a=this.model.get("filetype"),c={zip:"zip",doc:"doc",docx:"doc",pdf:"pdf",ppt:"ppt",pptx:"ppt",xls:"xls",xlsx:"xlsx",acc:"acc",avi:"avi",bmp:"bmp",c:"c",cpp:"cpp",dmg:"dmg",exe:"exe",flv:"flv",gif:"gif",h:"h",html:"html",ics:"ics",java:"java",jpg:"jpg",key:"key",mp3:"mp3",mid:"mid",mp4:"mp4",mpg:"mpg",php:"php",png:"png",psd:"psd",py:"py",qt:"qt",rar:"rar",rb:"rb",rtf:"rtf",sql:"sql",tiff:"tiff",txt:"txt",wav:"wav",xml:"xml"},d="_blank",e=b.has(c,a)?c[a]:d;e="url(/img/filetypes/"+e+".png)",this.$(".rowicon").css("background-image",e)},events:{click:"downloadfile"},downloadfile:function(){this.$el.trigger("downloadfile",this.model)}}),e.FolderView=c.View.extend({className:"tabrow itemview folderview",initialize:function(){b.bindAll(this,"drilldown")},render:function(){this.$el.html(d.itemview(this.model.toJSON()));var a=this.model.hasnewfiles();return a&&(a=a>10?"10+":a,this.$(".rowicon").append("<div class='notification'>"+a+"</div>")),this},events:{click:"drilldown"},drilldown:function(){this.$el.trigger("drilldown",this.model)}}),e}),function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d=typeof location!="undefined"&&location.href,e=d&&location.protocol&&location.protocol.replace(/\:/,""),f=d&&location.hostname,g=d&&(location.port||undefined),h=[];define("text",[],function(){var i,j,k;return typeof window!="undefined"&&window.navigator&&window.document?j=function(a,b){var c=i.createXhr();c.open("GET",a,!0),c.onreadystatechange=function(a){c.readyState===4&&b(c.responseText)},c.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node?(k=require.nodeRequire("fs"),j=function(a,b){b(k.readFileSync(a,"utf8"))}):typeof Packages!="undefined"&&(j=function(a,b){var c="utf-8",d=new java.io.File(a),e=java.lang.System.getProperty("line.separator"),f=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(d),c)),g,h,i="";try{g=new java.lang.StringBuffer,h=f.readLine(),h&&h.length()&&h.charAt(0)===65279&&(h=h.substring(1)),g.append(h);while((h=f.readLine())!==null)g.append(e),g.append(h);i=String(g.toString())}finally{f.close()}b(i)}),i={version:"1.0.2",strip:function(a){if(a){a=a.replace(b,"");var d=a.match(c);d&&(a=d[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}if(!b)throw new Error("createXhr(): XMLHttpRequest not available");return b},get:j,parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),e=a.substring(c+1,a.length);return c=e.indexOf("!"),c!==-1&&(b=e.substring(c+1,e.length),b=b==="strip",e=e.substring(0,c)),{moduleName:d,ext:e,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=i.xdRegExp.exec(a),f,g,h;return e?(f=e[2],g=e[3],g=g.split(":"),h=g[1],g=g[0],(!f||f===b)&&(!g||g===c)&&(!h&&!g||h===d)):!0},finishLoad:function(a,b,c,d,e){c=b?i.strip(c):c,e.isBuild&&(h[a]=c),d(c)},load:function(a,b,c,h){if(h.isBuild&&!h.inlineText){c();return}var j=i.parseName(a),k=j.moduleName+"."+j.ext,l=b.toUrl(k),m=h&&h.text&&h.text.useXhr||i.useXhr;!d||m(l,e,f,g)?i.get(l,function(b){i.finishLoad(a,j.strip,b,c,h)}):b([k],function(a){i.finishLoad(j.moduleName+"."+j.ext,j.strip,a,c,h)})},write:function(a,b,c,d){if(b in h){var e=i.jsEscape(h[b]);c.asModule(a+"!"+b,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,b,c,d,e){var f=i.parseName(b),g=f.moduleName+"."+f.ext,h=c.toUrl(f.moduleName+"."+f.ext)+".js";i.load(g,c,function(b){var c=function(a){return d(h,a)};c.asModule=function(a,b){return d.asModule(a,h,b)},i.write(a,g,c,e)},e)}},i})}(),define("text!templates/desktop.html",[],function(){return"<!-- OVERLAY -->\n<script id='loading' type=\"text/html\">\n\t<div class='modal message'>\n\t\t<div id='overlay_close'></div>\n\t\t<span>Loading your modules, Please be patient...</span>\n\t</div>\n</script>\n<script id='keyboardshortcuts' type=\"text/html\">\n\t<div class='modal keyboardshortcuts'>\n\t\t<div id='overlay_close'></div>\n\t\t<div class='title'>Keyboard shortcuts</div>\n\t\t<div class='contents'>\n\t\t\t<div class='navigation col'>\n\t\t\t\t<div class='coltitle'>Navigation</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>J</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Next</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>K</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Previous</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>Enter</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Action / Select</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>?</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>This menu</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>Esc</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Close this menu</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class='jumping col'>\n\t\t\t\t<div class='coltitle'>Jumping</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>G</span>\n\t\t\t\t\t\t<span class='key'>M</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Modules</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>G</span>\n\t\t\t\t\t\t<span class='key'>A</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Announcements</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>G</span>\n\t\t\t\t\t\t<span class='key'>W</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Workbin</span>\n\t\t\t\t</div>\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<span class='keys'>\n\t\t\t\t\t\t<span class='key'>G</span>\n\t\t\t\t\t\t<span class='key'>F</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class='desc'>Forum</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</script>\n\n<!-- MAIN -->\n<script id='moduleview' type='text/html'>\n\t<div class='modulecode'>{{code}}</div>\n</script>\n<script id=\"contentview\" type=\"text/html\">\n\t<div id=\"tabs\"></div>\n\t<div id=\"tabcontent\"></div>\n</script>\n\n<!-- BREADCRUMBS -->\n<script id='breadcrumb' type='text/html'>\n\t<div class='arrow'></div>\n\t<span>{{name}}</span>\n</script>\n<script id='breadcrumbicon' type='text/html'>\n\t<div class='icon {{type}}icon'></div>\n</script>\n\n\n<!-- FORUM -->\n<script id='forumview' type=\"text/html\">\n\t<div class='tabheading' id='forumheader'></div>\n\t<div class='tabcontents'>\n\t\t<!-- <div class='tabrowinfo tabrow'>\n\t\t\t<div class=\"rowname\">\n\t\t\t\t<div class='rowicon'></div>\n\t\t\t\t<span>Title</span>\n\t\t\t</div>\n\t\t\t<div class=\"rowcol2\"></div> \n\t\t\t<div class=\"rowcol3\"></div>\n\t\t</div> -->\n\t\t<div id='forumcontents'></div>\n\t</div>\n</script>\n<script id='forumheadingview' type=\"text/html\">\n\t<div class=\"rowname\">\n\t\t<div class='rowicon headingicon'></div>\n\t\t<span>{{name}}</span>\n\t</div>\n\t<div class=\"rowcol2\"></div>\n\t<div class=\"rowcol3\"></div>\n</script>\n<script id='forumthreadview' type=\"text/html\">\n\t<div class='rowicon threadicon'></div>\n\t<div class='posttitle'>\n\t\t<div class='posttitlemain'>\n\t\t\t<span class='main'>{{ name }}</span>\n\t\t\t<span class='dot'>&middot;</span>\n\t\t\t<span class='author'>{{ author }}</span>\n\t\t</div>\n\t\t<span class='date'>{{ nicedate }}</span>\n\t</div>\n</script>\n<script id='forumthreadsthreadview' type=\"text/html\">\n\t<div class=\"rowname\">\n\t\t<span>{{title}}</span>\n\t</div>\n\t<div class=\"rowcol2\"></div>\n\t<div class=\"rowcol3\"></div>\n</script>\n<script id='forumpost' type=\"text/html\">\n\t<div class='subthreadicon'></div>\n\t<div class='posttitle'>\n\t\t<div class='posttitlemain'>\n\t\t\t<span class='main'>{{ name }}</span>\n\t\t\t<span class='dot'>&middot;</span>\n\t\t\t<span class='author'>{{ author }}</span>\n\t\t</div>\n\t\t<span class='date'>{{ nicedate }}</span>\n\t</div>\n\t<div class='postbody'>{{{ body }}}</div>\n\t<div class='subthreads'></div>\n</script>\n\n\n<!-- ANNOUNCEMENTS -->\n<script id='announcementview' type=\"text/html\">\n\t<div class='posttitle'>\n\t\t<div class='posttitlemain'>\n\t\t\t<span class='main'>{{ title }}</span>\n\t\t\t<span class='dot'>&middot;</span>\n\t\t\t<span class='author'>{{ from }}</span>\n\t\t</div>\n\t\t<span class='date'>{{ nicedate }}</span>\n\t</div>\n\t<div class='postbody'>{{{ contents }}}</div>\n</script>\n<script id='inforow' type=\"text/html\">\n\t<div class='inforow tabrow'>{{text}}</div>\n</script>\n\n\n<!-- WORKBIN -->\n<script id='emptyfolder' type='text/html'>\n\t<div class='folder'>\n\t\t<span>this folder is empty.</span>\n\t</div>\n</script>\n<script id='loadingfolder' type='text/html'>\n\t<div class='folder'>\n\t\t<span>loading...</span>\n\t</div>\n</script>\n<script id='workbinview' type='text/html'>\n\t<div class='tabheading' id='workbinheading'></div>\n\t<div class='tabrowinfo tabrow'>\n\t\t<div class=\"rowname\">\n\t\t\t<div class='rowicon'></div>\n\t\t\t<span>Name</span>\n\t\t</div>\n\t\t<div class=\"rowcol2\">Kind</div>\n\t\t<div class=\"rowcol3\">Size</div>\n\t</div>\n\t<div id='filescontainer'><div>\n</script>\n<script id='itemview' type='text/html'>\n\t<div class=\"rowname\">\n\t\t<div class='rowicon {{filetype}}'></div>\n\t\t<span>{{name}}</span>\n\t</div>\n\t<div class=\"rowcol2\">{{kind}}</div>\n\t<div class=\"rowcol3\">{{size}}</div>\n</script>"}),function(a,b){typeof define=="function"&&define.amd?define("keyboardjs",[],b):a.KeyboardJS=b()}(this,function(){function a(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(b){return c.call(a,b)})}function g(){var a=[];for(var b=f.length;b>-1;b-=1)if(f[b]){var c=f[b];for(var e=0;e<c.length;e+=1){var g=c[e],h=!0;for(var i=0;i<g.keys.length;i+=1){var j=g.keys[i];d.indexOf(j)<0&&(h=!1)}h&&a.push(g)}}return a}function h(a){if(d<1)return!0;var b=g(),c=[],f;for(var h=0;h<b.length;h+=1){var i=b[h],j=!1;for(var k=0;k<i.keys.length;k+=1){var l=i.keys[k];if(c.indexOf(l)>-1){j=!0;break}}if(!j){typeof i.callback=="function"&&(i.callback(a,i.keys,i.keyCombo)||(f=!1)),e[i.keyCombo]||(e[i.keyCombo]=i);for(var k=0;k<i.keys.length;k+=1){var l=i.keys[k];c.indexOf(l)<0&&c.push(l)}}}return c.length?!1:f}function i(a){var b=g(),c;for(var d in e)if(e.hasOwnProperty(d)){var f=e[d],h=!1;for(var i=0;i<b.length;i+=1){var j=b[i].keyCombo;if(j===d){h=!0;break}}h||(typeof f.endCallback=="function"&&(f.endCallback(a,f.keys,f.keyCombo)||(c=!1)),delete e[d])}return c}function j(a,b,c){function d(){if(h&&h.length){var a=f[h.length];if(a.indexOf(i)>-1){var b=f[h.length].indexOf(i);f[h.length].splice(b,1)}}}var e=a.toLowerCase().replace(/\s/g,"").split(",");for(var g=0;g<e.length;g+=1){var h=e[g].split("+");if(h.length){f[h.length]||(f[h.length]=[]);var i={callback:b,endCallback:c,keyCombo:e[g],keys:h};f[h.length].push(i)}}return{clear:d}}function k(a,b,c,d,e){function f(){typeof h=="function"&&h(),typeof i=="function"&&i(),typeof k=="function"&&k(),typeof l=="function"&&l(),typeof m=="function"&&clearInterval(m)}var g=[0,0];if(typeof e!="function")return!1;var h=j(a,function(){g[0]===0&&(g[0]=-1)},function(){g[0]=0}).clear,i=j(b,function(){g[0]===0&&(g[0]=1)},function(){g[0]=0}).clear,k=j(c,function(){g[1]===0&&(g[1]=-1)},function(){g[1]=0}).clear,l=j(d,function(){g[1]===0&&(g[1]=1)},function(){g[1]=0}).clear,m=setInterval(function(){if(g[0]===0&&g[1]===0)return;e(g)},1);return{clear:f}}function l(a){if(a==="all"){f=[];return}a=a.replace(/\s/g,"").split(",");for(var b=f.length;b>-1;b-=1)if(f[b]){var c=f[b];for(var d=0;d<c.length;d+=1){var e=c[d],g=!1;for(var h=0;h<e.keys.length;h+=1){var i=e.keys[h];for(var j=0;j<a.length;j+=1){var k=a[j];if(k===i){g=!0;break}}if(g)break}g&&(f[b].splice(d,1),d-=1,f[b].length<1&&delete f[b])}}}function m(){return d}function n(a,c){b[a]=c}function o(a){b[a]&&(c=b[a])}[].indexOf||(Array.prototype.indexOf=function(a,b,c){for(c=this.length,b=(c+~~b)%c;b<c&&(!(b in this)||this[b]!==a);b++);return b^c?b:-1});var b={us:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,"break":19,capslock:20,escape:27,esc:27,space:32,spacebar:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,meta:91,command:91,windows:91,win:91,_91:92,select:93,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,num:144,scrolllock:145,scroll:145,semicolon:186,equal:187,equalsign:187,comma:188,dash:189,period:190,slash:191,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222}},c=b.us,d=[],e={},f=[];return a(document,"keydown",function(a){for(var b in c)c.hasOwnProperty(b)&&a.keyCode===c[b]&&d.indexOf(b)<0&&d.push(b);return h(a)}),a(document,"keyup",function(a){for(var b in c)if(c.hasOwnProperty(b)&&a.keyCode===c[b]){var e=d.indexOf(b);e>-1&&d.splice(e,1)}return i(a)}),{bind:{key:j,axis:k},activeKeys:m,unbind:{key:l},locale:{add:n,set:o}}}),define("app",["jquery","underscore","backbone","ich","ivle","models","views","text!templates/desktop.html","keyboardjs"],function(a,b,c,d,e,f,g,h,i){a("body").append(h),d.grabTemplates();var j=function(a,b){i.bind.key(a,b,function(){})},k=c.View.extend({el:"#container",initialize:function(a){this.parent=a.parent,this.shortcuts(),this.resetstate()},shortcuts:function(){var b=this;j("shift + slash",function(){a("#overlay").html(d.keyboardshortcuts()).show(),a("#overlay_close").click(function(){a("#overlay").html("").hide()})}),j("esc",function(){a("#overlay").html("").hide()}),j("g + a",function(){b.currentview="announcements",b.parent.mainview.contentview.changeview(null,b.currentview)}),j("g + w",function(){b.currentview="workbin",b.parent.mainview.contentview.changeview(null,b.currentview)}),j("g + f",function(){b.currentview="forum",console.log("asdf"),b.parent.mainview.contentview.changeview(null,b.currentview)}),j("g + m",function(){b.currentview="modules"}),j("j",function(){b.up()}),j("k",function(){b.down()}),j("enter",function(){b.select()})},events:{},resetstate:function(a,b){this.currentview=a||"modules",this.currentindex=b},incrindex:function(){return typeof this.currentindex!="number"?this.currentindex=0:this.currentindex+=1,this.padindex(),this.currentindex},decrindex:function(){return typeof this.currentindex!="number"?this.currentindex=0:this.currentindex-=1,this.padindex(),this.currentindex},up:function(){var a=this.incrindex();this.highlight(a)},down:function(){var a=this.decrindex();this.highlight(a)},select:function(){var a=this.viewcollection(),b=this.currentindex||0;if(this.currentview==="modules"){var c=a[b];this.parent.mainview.moduleselected({},c)}},viewcollection:function(){var a,b;return this.currentview==="modules"?a=this.parent.mainview.modulesview.collection.models:this.currentview==="forum"?(b=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,b.type==="forum"?a=b.headings.models:b.type==="heading"?a=b.threads.models:b.type==="thread"&&(a="dontloop")):this.currentview==="workbin"?(b=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,a=b.items.models):this.currentview==="announcements"&&(a=this.parent.mainview.contentview.contentcontainer.viewobj.announcements.models),a},highlightobj:function(){var a,b;return this.currentview==="modules"?a=this.parent.mainview.modulesview:this.currentview==="forum"?(b=this.parent.mainview.contentview.contentcontainer.viewobj.currentitem,b.type==="forum"?a=b.headings.models:b.type==="heading"?a=b.threads.models:b.type==="thread"&&(a="dontloop")):this.currentview==="workbin"?a=this.parent.mainview.contentview.contentcontainer.viewobj:this.currentview==="announcements"&&(a=this.parent.mainview.contentview.contentcontainer.viewobj.announcements.models),a},highlight:function(){this.highlightobj().highlight(this.currentindex)},padindex:function(){this.currentindex>=0?this.currentindex%=this.lengthofview():this.currentindex=this.lengthofview()+this.currentindex},lengthofview:function(){var a=this.viewcollection(this.currentview),b=a==="dontloop"?this.currentindex+1:a.length;return b}}),l=c.Router.extend({initialize:function(a){this.parent=a.parent},routes:{":mod/workbin*stuff":"workbin",":mod/announcements":"announcements",":mod/forum*stuff":"forum","*mod":"module"},module:function(a){var b=this.checkmod(a);b?this.parent.mainview.moduleselected(null,b):this.navigate("")},workbin:function(a,c){var d=this.checkmod(a);if(!d)return this.navigate("");if(c){var e=c.split("/").slice(1),f,g=d.workbin;while(e.length!==0){f=b.find(g.items.models,function(a){return this.sanitize(a.get("path"))===e[0]},this);if(f)g=f;else break;e=e.slice(1)}if(f)this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"workbin"),this.parent.mainview.contentview.contentcontainer.viewobj.drilldown(null,f);else return this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"workbin"),this.navigateto(d.get("code"),"workbin")}else this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"workbin")},announcements:function(a){var b=this.checkmod(a);if(!b)return this.navigate("");this.parent.mainview.moduleselected(null,b),this.parent.mainview.contentview.changeview(null,"announcements")},forum:function(a,c){var d=this.checkmod(a);if(!d)return this.navigate("");if(c){var e=c.split("/").slice(1),f,g=d.forum;while(e.length!==0){var h=g.headings||g.threads;f=b.find(h.models,function(a){return this.sanitize(a.get("path"))===e[0]},this);if(f)g=f;else break;e=e.slice(1)}if(f)this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"forum"),this.parent.mainview.contentview.contentcontainer.viewobj.drilldown(null,f);else return this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"forum"),this.navigateto(d.get("code"),"forum")}else this.parent.mainview.moduleselected(null,d),this.parent.mainview.contentview.changeview(null,"forum")},checkmod:function(a){return b.find(this.parent.modules.models,function(b){return this.sanitize(b.get("code"))===this.sanitize(a.toLowerCase())},this)},sanitize:function(a){return a.replace(/\//g,"-").replace(/ /g,"").toLowerCase()},navigateto:function(){var a=b.map(arguments,function(a){return this.sanitize(a)},this),c=a[1];mixpanel.track(c),this.navigate(a.join("/")),this.trackpageview()},trackpageview:function(){var a=c.history.getFragment();_gaq.push(["_trackPageview","/"+a])}}),m=c.View.extend({el:"#container",initialize:function(){var a="ba1ge5NQ9cl76KQNI1Suc";this.ivle=new e(a,"/proxy/"),this.modules={},this.router=new l({parent:this}),b.bindAll(this,"start")},start:function(){this.bootstrap=bootstrap,this.usertoken=this.bootstrap.token,this.user=new this.ivle.user(this.usertoken);var a=this;if(this.bootstrap.modules){var d=b.map(this.bootstrap.modules,function(a){var b=new f.Module(a,{user:this.user});return b},this);this.modules=new f.Modules(d,{user:this.user}),this.modules.fetch()}else this.loading(),this.modules=new f.Modules([],{user:this.user}),this.modules.fetch(function(){a.stoploading()});this.render(),this.validateuser(),c.history.start({pushState:!0})},validateuser:function(){var b=this;this.user.validate(function(c){if(c.Success!==!1){c.Token!==b.usertoken&&(b.usertoken=c.Token,b.user.setauthtoken(b.usertoken),b.modules.fetch());var d=/^\/Date\((.*)+.*\)\//,e=d.exec(c.ValidTill),f=e?new Date(parseInt(e[1],10)):e;f&&(f!==b.bootstrap.date||b.usertoken!==b.bootstrap.token)&&a.ajax({type:"POST",url:"/auth",data:{token:b.usertoken,date:f},success:function(a){},dataType:"json"})}},function(){});var c=this.bootstrap.user;c?mixpanel.identify(c.uid):b.user.uid(function(c){b.user.email(function(d){b.user.uname(function(e){a.ajax({type:"POST",url:"/user",data:{uid:c,email:d},success:function(a){},dataType:"json"}),b.bootstrap.user={uname:e,uid:c,email:d},mixpanel.identify(c),mixpanel.people.set({$name:e,$email:d})})})})},loading:function(){a("#overlay").html(d.loading()).show();var b=this;a("#overlay_close").click(function(){b.stoploading()})},stoploading:function(){a("#overlay").html("").hide()},render:function(){this.mainview=new g.MainView({user:this.user,modules:this.modules}),this.mainview.render()},logout:function(){var a=new RegExp("^(.+"+window.location.host+")"),b=a.exec(window.location.href)[1]+"/logout";window.location.href=b},navigateto:function(a){var b=Array.prototype.slice.call(arguments,1);this.router.navigateto.apply(this.router,b)},events:{"click #logout":"logout",navigateto:"navigateto"}});return m}),require.config({paths:{jquery:"libs/zeptowrapper",underscore:"libs/underscore",backbone:"libs/backbone",ich:"libs/icanhazamd",keyboardjs:"libs/keyboard",ivle:"libs/ivle",app:"scripts/desktop_app",views:"scripts/desktop_views",models:"scripts/models"}}),require(["app"],function(a){var b=new a;b.start()}),define("desktop_main",function(){})})()